!function(t,n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define("JZZ",[],n);else{if(t||(t=window),t.JZZ&&t.JZZ.MIDI)return;t.JZZ=n()}}(this,function(){var t,n,e,i,r,o,s,u,a,f,h="undefined"==typeof window?global:window,c="1.6.6",$=Date.now||function(){return new Date().getTime()},l=$(),p="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return $()-l},d=function(t){setTimeout(t,0)};function g(){}function x(t){return"function"==typeof t}function m(){this._orig=this,this._ready=!1,this._queue=[],this._log=[]}function v(t,n){this._bad?x(n)&&n.apply(this,[Error(this._err())]):x(t)&&t.apply(this,[this])}function _(t,n){this._bad?t._crash(this._err()):setTimeout(function(){t._resume()},n)}function y(t){this._bad&&t._break(this._err()),t._resume()}function b(t,n,e){t[e]=function(){var t=arguments,i=n._image();return this._push(y,[i]),i[e].apply(i,t)}}function M(t){this._bad||(x(t)?t.apply(this):console.log(t))}function C(t){this._bad&&(x(t)?t.apply(this):console.log(t))}function S(t){this._bad?t._crash(this._err()):(this._break("Closed"),t._resume())}function B(t){if(!t.length){this._break();return}var n=t.shift();if(t.length){var e=this;this._slip(C,[function(){B.apply(e,[t])}])}try{this._repair(),n.apply(this)}catch(i){this._break(i.toString())}}function T(t,n){for(var e=0;e<t.length;e++)if(t[e]===n)return;t.push(n)}function w(t,n){for(var e=0;e<t.length;e++)if(t[e]===n){t.splice(e,1);return}}function F(){m.apply(this)}function A(t,n){for(var e in t)t.hasOwnProperty(e)&&n.call(this,e)}function P(t,n,e){if(void 0===n)return P(t,[],[]);if(t instanceof Object){for(var i,r=0;r<n.length;r++)if(n[r]===t)return e[r];return i=t instanceof Array?[]:{},n.push(t),e.push(i),A(t,function(r){i[r]=P(t[r],n,e)}),i}return t}m.prototype._exec=function(){for(;this._ready&&this._queue.length;){var t=this._queue.shift();t[0].apply(this,t[1])}},m.prototype._push=function(t,n){this._queue.push([t,n]),m.prototype._exec.apply(this)},m.prototype._slip=function(t,n){this._queue.unshift([t,n])},m.prototype._pause=function(){this._ready=!1},m.prototype._resume=function(){this._ready=!0,m.prototype._exec.apply(this)},m.prototype._break=function(t){this._orig._bad=!0,this._orig._log.push(t||"Unknown JZZ error")},m.prototype._repair=function(){this._orig._bad=!1},m.prototype._crash=function(t){this._break(t),this._resume()},m.prototype._err=function(){return this._log[this._log.length-1]},m.prototype.log=function(){return P(this._log)},m.prototype._dup=function(){var t=function(){};t.prototype=this._orig;var n=new t;return n._ready=!1,n._queue=[],n},m.prototype._image=function(){return this._dup()},m.prototype._thenable=function(){if(this.then)return this;var t=this,n=function(){};n.prototype=t;var e=new n;return e.then=function(n,e){return t._push(v,[n,e]),this},e},m.prototype.wait=function(t){if(!t)return this;var n=this._image();return this._push(_,[n,t]),n._thenable()},m.prototype.and=function(t){return this._push(M,[t]),this._thenable()},m.prototype.or=function(t){return this._push(C,[t]),this._thenable()},m.prototype._info={},m.prototype.info=function(){var t=P(this._orig._info);return void 0===t.engine&&(t.engine="none"),void 0===t.sysex&&(t.sysex=!0),t},m.prototype.name=function(){return this.info().name},m.prototype.close=function(){var t=new m;return this._close&&this._push(this._close,[]),this._push(S,[t]),t._thenable()},F.prototype=new m,F.prototype._info={name:"JZZ.js",ver:c,version:c,inputs:[],outputs:[]};var O=[],I=[],E=[],k=[],D={},L={};function N(){for(e=0,o._info.engine=tn._type,o._info.version=tn._version,o._info.sysex=tn._sysex,o._info.inputs=[],o._info.outputs=[],O=[],I=[],tn._allOuts={},tn._allIns={};e<tn._outs.length;e++)D[(i=tn._outs[e]).name]||(i.engine=tn,tn._allOuts[i.name]=i,o._info.outputs.push({id:i.name,name:i.name,manufacturer:i.manufacturer,version:i.version,engine:tn._type}),O.push(i));for(e=0;e<te._outs.length;e++)D[(i=te._outs[e]).name]||(o._info.outputs.push({id:i.name,name:i.name,manufacturer:i.manufacturer,version:i.version,engine:i.type}),O.push(i));for(e=0;e<tn._ins.length;e++)L[(i=tn._ins[e]).name]||(i.engine=tn,tn._allIns[i.name]=i,o._info.inputs.push({id:i.name,name:i.name,manufacturer:i.manufacturer,version:i.version,engine:tn._type}),I.push(i));for(e=0;e<te._ins.length;e++)L[(i=te._ins[e]).name]||(o._info.inputs.push({id:i.name,name:i.name,manufacturer:i.manufacturer,version:i.version,engine:i.type}),I.push(i));if(o._watcher&&o._watcher._handles.length){var e,i,r=function t(n,e,i,r){if(function t(n,e,i,r){var o;if(n.length!=i.length||e.length!=r.length)return!0;for(o=0;o<n.length;o++)if(n[o].name!=i[o].name)return!0;for(o=0;o<e.length;o++)if(e[o].name!=r[o].name)return!0;return!1}(n,e,i,r)){var o,s=[],u=[],a=[],f=[],h={};for(o=0;o<n.length;o++)h[n[o].name]=!0;for(o=0;o<i.length;o++)h[i[o].name]||s.push(i[o]);for(o=0,h={};o<i.length;o++)h[i[o].name]=!0;for(o=0;o<n.length;o++)h[n[o].name]||a.push(n[o]);for(o=0,h={};o<e.length;o++)h[e[o].name]=!0;for(o=0;o<r.length;o++)h[r[o].name]||u.push(r[o]);for(o=0,h={};o<r.length;o++)h[r[o].name]=!0;for(o=0;o<e.length;o++)h[e[o].name]||f.push(e[o]);return{inputs:{added:s,removed:a},outputs:{added:u,removed:f}}}}(k,E,o._info.inputs,o._info.outputs);if(r){for(n=0;n<r.inputs.removed.length;n++)(i=tn._inMap[r.inputs.removed[n].name])&&i._closeAll();for(n=0;n<r.outputs.removed.length;n++)(i=tn._outMap[r.outputs.removed[n].name])&&i._closeAll();!function n(e){for(t=0;t<o._watcher._handles.length;t++)o._watcher._handles[t].apply(o,[e])}(r)}}k=o._info.inputs,E=o._info.outputs}function G(){this._bad||tn._refresh(this)}function q(t,n){x(t)&&(t=t(n)),t instanceof Array||(t=[t]);var e,i,r=[],o=[],s=n.slice(),u=r;for(e=0;e<t.length;e++)if(void 0===t[e])u=o;else if(t[e]instanceof RegExp)for(i=0;i<s.length;i++)t[e].test(s[i].name)&&(u.push(s[i]),s.splice(i,1),i--);else for(i=0;i<s.length;i++)(t[e]+""==i+""||t[e]===s[i].name||t[e]instanceof Object&&t[e].name===s[i].name)&&(u.push(s[i]),s.splice(i,1),i--);return u==r?r:r.concat(s).concat(o)}function z(t,n){var e;e=n instanceof RegExp?"Port matching "+n+" not found":n instanceof Object||void 0===n?"Port not found":'Port "'+n+'" not found',t._crash(e)}function R(t,n){if(this._bad)t._crash(this._err());else{var e=q(n,O);if(!e.length){z(t,n);return}for(var i=function(t){return function(){t.engine._openOut(this,t.name)}},r=0;r<e.length;r++)e[r]=i(e[r]);t._slip(B,[e]),t._resume()}}function V(t,n){if(this._bad)t._crash(this._err());else{var e=q(n,I);if(!e.length){z(t,n);return}for(var i=function(t){return function(){t.engine._openIn(this,t.name)}},r=0;r<e.length;r++)e[r]=i(e[r]);t._slip(B,[e]),t._resume()}}function j(t,n){this._bad?t._crash():(t._slip(Y,[n]),t._resume())}function U(){m.apply(this),this._handles=[],this._outs=[]}function W(t){this._bad||this._receive(t)}function Z(t){this._emit(t)}function J(t){x(t)?T(this._orig._handles,t):T(this._orig._outs,t)}function X(t){void 0===t?(this._orig._handles=[],this._orig._outs=[]):x(t)?w(this._orig._handles,t):w(this._orig._outs,t)}function H(t,n){this._orig._mpe||(this._orig._mpe=new nn),this._orig._mpe.setup(t,n)}function Q(t){if(t!=parseInt(t)||t<0||t>15)throw RangeError("Bad channel value (must not be less than 0 or more than 15): "+t)}function K(){m.apply(this),this._handles=[],b(this,o,"refresh"),b(this,o,"openMidiOut"),b(this,o,"openMidiIn"),b(this,o,"onChange"),b(this,o,"close")}function Y(t){x(t)&&(this._orig._handles.length||tn._watch(),T(this._orig._handles,t))}function tt(t){void 0===t?this._orig._handles=[]:w(this._orig._handles,t),this._orig._handles.length||tn._unwatch()}F.prototype.refresh=function(){return this._push(G,[]),this._thenable()},F.prototype.openMidiOut=function(t){var n=new U;return this._push(G,[]),this._push(R,[n,t]),n._thenable()},F.prototype._openMidiOutNR=function(t){var n=new U;return this._push(R,[n,t]),n._thenable()},F.prototype.openMidiIn=function(t){var n=new U;return this._push(G,[]),this._push(V,[n,t]),n._thenable()},F.prototype._openMidiInNR=function(t){var n=new U;return this._push(V,[n,t]),n._thenable()},F.prototype.onChange=function(t){this._orig._watcher||(this._orig._watcher=new K);var n=this._orig._watcher._image();return this._push(j,[n,t]),n._thenable()},F.prototype._close=function(){tn._close()},U.prototype=new m,U.prototype._filter=function(t){if(this._orig._mpe){var n,e=0;this._handles&&this._handles.length&&(e=this._handles.length,n=this._handles[0]),this._outs&&this._outs.length&&(e=this._outs.length,n=this._outs[0]),1!=e||n._mpe||(t=this._orig._mpe.filter(t))}return t},U.prototype._receive=function(t){this._emit(this._filter(t))},U.prototype.send=function(){return this._push(W,[tm.apply(null,arguments)]),this._thenable()},U.prototype.note=function(t,n,e,i){return this.noteOn(t,n,e),void 0===this._ch&&void 0===this._master?i>0&&this.wait(i).noteOff(t,n):e>0&&this.wait(e).noteOff(t),this._thenable()},U.prototype._emit=function(t){var n;for(n=0;n<this._handles.length;n++)this._handles[n].apply(this,[tm(t)._stamp(this)]);for(n=0;n<this._outs.length;n++){var e=tm(t);e._stamped(this._outs[n])||this._outs[n].send(e._stamp(this))}},U.prototype.emit=function(t){return this._push(Z,[t]),this._thenable()},U.prototype.connect=function(t){return this._push(J,[t]),this._thenable()},U.prototype.disconnect=function(t){return this._push(X,[t]),this._thenable()},U.prototype.connected=function(){return this._orig._handles.length+this._orig._outs.length},U.prototype._image=function(){var t=this._dup();return t._ch=this._ch,t._sxid=this._sxid,t._master=this._master,t._band=this._band,t},U.prototype._ch=void 0,U.prototype._sxid=127,U.prototype._master=void 0,U.prototype._band=void 0,U.prototype.sxId=function(t){if(void 0===t&&(t=U.prototype._sxid),t==this._sxid)return this._thenable();t=tS(t);var n=this._image();return n._sxid=t,this._push(y,[n]),n._thenable()},U.prototype.ch=function(t){if(t==this._ch||void 0===t&&void 0===this._ch)return this._thenable();var n=this._image();return void 0!==t&&(t=tC(t)),n._ch=t,n._master=void 0,n._band=void 0,this._push(y,[n]),n._thenable()},U.prototype.mpe=function(t,n){if(t==this._master&&n==this._band||void 0===t&&void 0===this._master)return this._thenable();if(void 0!==t&&nn.validate(t,n),!n)return this.ch(t);var e=this._image();return e._ch=void 0,e._master=t,e._band=n,this._push(H,[t,n]),this._push(y,[e]),e._thenable()},K.prototype=new m,K.prototype.connect=function(t){return this._push(Y,[t]),this._thenable()},K.prototype.disconnect=function(t){return this._push(tt,[t]),this._thenable()};var tn={_outs:[],_ins:[]},te={_outs:[],_ins:[]};function ti(){if("undefined"!=typeof module&&module.exports){var t,n=require("jazz-midi");if(n){t=n,tn._type="node",tn._main=t,tn._pool=[],tn._newPlugin=function(){return new t.MIDI},tc();return}}this._break()}function tr(){var t,n=document.createElement("div");n.style.visibility="hidden",document.body.appendChild(n);var e=document.createElement("object");if(e.style.visibility="hidden",e.style.width="0px",e.style.height="0px",e.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",e.type="audio/x-jazz",document.body.appendChild(e),e.isJazz){t=e,tn._type="plugin",tn._main=t,tn._pool=[t],tn._newPlugin=function(){var n=document.createElement("object");return n.style.visibility="hidden",n.style.width="0px",t.style.height="0px",n.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",n.type="audio/x-jazz",document.body.appendChild(n),n.isJazz?n:void 0},tc();return}this._break()}function to(){if("undefined"!=typeof navigator&&navigator.requestMIDIAccess){s=navigator,u=navigator.requestMIDIAccess;try{-1!=u.toString().indexOf("JZZ(")&&(u=void 0)}catch(t){}}}function ts(){if(to(),u){var t=this,n=function(n){t$(n),t._resume()},e=function(n){t._crash(n)};u.call(s,{}).then(n,e),this._pause();return}this._break()}function tu(){if(to(),u){var t=this,n=function(n){t$(n,!0),t._resume()},e=function(n){t._crash(n)};u.call(s,{sysex:!0}).then(n,e),this._pause();return}this._break()}function ta(){var t,n,e=this;function i(r){t=!0;var o=r.detail;if(!o){if(n||(n=document.getElementById("jazz-midi-msg")),!n)return;try{o=JSON.parse(n.innerText)}catch(s){}n.innerText=""}document.removeEventListener("jazz-midi-msg",i),"version"===o[0]?(function t(n,e){var i;function r(){for(var t=0;t<this.clients.length;t++)this._close(this.clients[t])}tn._type="extension",tn._version=e,tn._sysex=!0,tn._pool=[],tn._outs=[],tn._ins=[],tn._inArr=[],tn._outArr=[],tn._inMap={},tn._outMap={},tn._outsW=[],tn._insW=[],tn.refreshClients=[],tn._msg=n,tn._newPlugin=function(){var t={id:tn._pool.length};tn._pool.push(t),t.id?document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["new"]})):t.ready=!0},tn._newPlugin(),tn._refresh=function(t){tn.refreshClients.push(t),t._pause(),d(function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["refresh"]}))})},tn._openOut=function(t,n){var e=tn._outMap[n];if(!e){tn._pool.length<=tn._outArr.length&&tn._newPlugin();var i=tn._pool[tn._outArr.length];(e={name:n,clients:[],info:{name:n,manufacturer:tn._allOuts[n].manufacturer,version:tn._allOuts[n].version,type:"MIDI-out",sysex:tn._sysex,engine:tn._type},_start:function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["openout",i.id,n]}))},_close:function(t){tn._closeOut(t)},_closeAll:r,_receive:function(t){if(t.length){var n=t.slice();n.splice(0,0,"play",i.id),document.dispatchEvent(new CustomEvent("jazz-midi",{detail:n}))}}}).plugin=i,i.output=e,tn._outArr.push(e),tn._outMap[n]=e}t._orig._impl=e,T(e.clients,t._orig),t._info=e.info,t._receive=function(t){e._receive(t)},t._close=function(){e._close(this)},!e.open&&(t._pause(),e.plugin.ready&&e._start())},tn._openIn=function(t,n){var e=tn._inMap[n];if(!e){tn._pool.length<=tn._inArr.length&&tn._newPlugin();var i=tn._pool[tn._inArr.length];(e={name:n,clients:[],info:{name:n,manufacturer:tn._allIns[n].manufacturer,version:tn._allIns[n].version,type:"MIDI-in",sysex:tn._sysex,engine:tn._type},_start:function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["openin",i.id,n]}))},_close:function(t){tn._closeIn(t)},_closeAll:r}).plugin=i,i.input=e,tn._inArr.push(e),tn._inMap[n]=e}t._orig._impl=e,T(e.clients,t._orig),t._info=e.info,t._close=function(){e._close(this)},!e.open&&(t._pause(),e.plugin.ready&&e._start())},tn._closeOut=function(t){var n=t._impl;w(n.clients,t._orig),!n.clients.length&&n.open&&(n.open=!1,document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["closeout",n.plugin.id]})))},tn._closeIn=function(t){var n=t._impl;w(n.clients,t._orig),!n.clients.length&&n.open&&(n.open=!1,document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["closein",n.plugin.id]})))},tn._close=function(){tn._unwatch()},tn._watch=function(){tn._insW=tn._ins,tn._outsW=tn._outs,i=setInterval(function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["refresh"]}))},250)},tn._unwatch=function(){clearInterval(i),i=void 0},document.addEventListener("jazz-midi-msg",function(t){var n,e,i,r=t.detail?[t.detail]:void 0;if(!r)for(n=0,r=tn._msg.innerText.split("\n"),tn._msg.innerText="";n<r.length;n++)try{r[n]=JSON.parse(r[n])}catch(o){r[n]=[]}for(n=0;n<r.length;n++){var s=r[n];if(s.length){if("refresh"===s[0]){if(s[1].ins){for(e=0;e<s[1].ins.length;e++)s[1].ins[e].type=tn._type;tn._ins=s[1].ins}if(s[1].outs){for(e=0;e<s[1].outs.length;e++)s[1].outs[e].type=tn._type;tn._outs=s[1].outs}for(N(),e=0;e<tn.refreshClients.length;e++)tn.refreshClients[e]._resume();tn.refreshClients=[]}else if("version"===s[0]){var u=tn._pool[s[1]];u&&(u.ready=!0,u.input&&u.input._start(),u.output&&u.output._start())}else if("openout"===s[0]){if(i=tn._pool[s[1]].output){if(s[2]==i.name){if(i.open=!0,i.clients)for(e=0;e<i.clients.length;e++)i.clients[e]._resume()}else if(i.clients)for(e=0;e<i.clients.length;e++)i.clients[e]._crash()}}else if("openin"===s[0]){if(i=tn._pool[s[1]].input){if(s[2]==i.name){if(i.open=!0,i.clients)for(e=0;e<i.clients.length;e++)i.clients[e]._resume()}else if(i.clients)for(e=0;e<i.clients.length;e++)i.clients[e]._crash()}}else if("midi"===s[0]&&(i=tn._pool[s[1]].input)&&i.clients)for(e=0;e<i.clients.length;e++){var a=tm(s.slice(3));i.clients[e]._emit(a)}}}})}(n,o[2]),e._resume()):e._crash()}this._pause();try{document.addEventListener("jazz-midi-msg",i),document.dispatchEvent(new Event("jazz-midi"))}catch(r){}setTimeout(function(){t||e._crash()},50)}function tf(){this._pause();var t=this;d(function(){t._crash()})}function th(){tn._type="none",tn._version=c,tn._sysex=!0,tn._outs=[],tn._ins=[],tn._refresh=function(){N()},tn._watch=g,tn._unwatch=g,tn._close=g}function tc(){var t;function n(){for(var t=0;t<this.clients.length;t++)this._close(this.clients[t])}tn._inArr=[],tn._outArr=[],tn._inMap={},tn._outMap={},tn._outsW=[],tn._insW=[],tn._version=tn._main.version,tn._sysex=!0,tn._refresh=function(){var t,n;for(t=0,tn._outs=[],tn._ins=[];(n=tn._main.MidiOutInfo(t)).length;t++)tn._outs.push({type:tn._type,name:n[0],manufacturer:n[1],version:n[2]});for(t=0;(n=tn._main.MidiInInfo(t)).length;t++)tn._ins.push({type:tn._type,name:n[0],manufacturer:n[1],version:n[2]});N()},tn._openOut=function(t,e){var i=tn._outMap[e];if(!i){tn._pool.length<=tn._outArr.length&&tn._pool.push(tn._newPlugin()),i={name:e,clients:[],info:{name:e,manufacturer:tn._allOuts[e].manufacturer,version:tn._allOuts[e].version,type:"MIDI-out",sysex:tn._sysex,engine:tn._type},_close:function(t){tn._closeOut(t)},_closeAll:n,_receive:function(t){t.length&&this.plugin.MidiOutRaw(t.slice())}};var r=tn._pool[tn._outArr.length];i.plugin=r,tn._outArr.push(i),tn._outMap[e]=i}if(!i.open){var o=i.plugin.MidiOutOpen(e);if(o!==e){o&&i.plugin.MidiOutClose(),t._break();return}i.open=!0}t._orig._impl=i,T(i.clients,t._orig),t._info=i.info,t._receive=function(t){i._receive(t)},t._close=function(){i._close(this)}},tn._openIn=function(t,e){var i=tn._inMap[e];if(!i){tn._pool.length<=tn._inArr.length&&tn._pool.push(tn._newPlugin()),(i={name:e,clients:[],info:{name:e,manufacturer:tn._allIns[e].manufacturer,version:tn._allIns[e].version,type:"MIDI-in",sysex:tn._sysex,engine:tn._type},_close:function(t){tn._closeIn(t)},_closeAll:n,handle:function(t,n){for(var e=0;e<this.clients.length;e++){var i=tm(n);this.clients[e]._emit(i)}}}).onmidi=(r=i,function(t,n){r.handle(t,n)});var r,o=tn._pool[tn._inArr.length];i.plugin=o,tn._inArr.push(i),tn._inMap[e]=i}if(!i.open){var s=i.plugin.MidiInOpen(e,i.onmidi);if(s!==e){s&&i.plugin.MidiInClose(),t._break();return}i.open=!0}t._orig._impl=i,T(i.clients,t._orig),t._info=i.info,t._close=function(){i._close(this)}},tn._closeOut=function(t){var n=t._impl;w(n.clients,t._orig),!n.clients.length&&n.open&&(n.open=!1,n.plugin.MidiOutClose())},tn._closeIn=function(t){var n=t._impl;w(n.clients,t._orig),!n.clients.length&&n.open&&(n.open=!1,n.plugin.MidiInClose())},tn._close=function(){for(var t=0;t<tn._inArr.length;t++)tn._inArr[t].open&&tn._inArr[t].plugin.MidiInClose();tn._unwatch()},tn._watch=function(){t||(t=setInterval(function(){tn._refresh()},250))},tn._unwatch=function(){t&&clearInterval(t),t=void 0}}function t$(t,n){var e;function i(){for(var t=0;t<this.clients.length;t++)this._close(this.clients[t])}tn._type="webmidi",tn._version=43,tn._sysex=!!n,tn._access=t,tn._inMap={},tn._outMap={},tn._outsW=[],tn._insW=[],tn._refresh=function(){tn._outs=[],tn._ins=[],tn._access.outputs.forEach(function(t){tn._outs.push({type:tn._type,name:t.name,manufacturer:t.manufacturer,version:t.version})}),tn._access.inputs.forEach(function(t){tn._ins.push({type:tn._type,name:t.name,manufacturer:t.manufacturer,version:t.version})}),N()},tn._openOut=function(t,n){var e,r=tn._outMap[n];r||(r={name:n,clients:[],info:{name:n,manufacturer:tn._allOuts[n].manufacturer,version:tn._allOuts[n].version,type:"MIDI-out",sysex:tn._sysex,engine:tn._type},_close:function(t){tn._closeOut(t)},_closeAll:i,_receive:function(t){r.dev&&t.length&&this.dev.send(t.slice())}}),tn._access.outputs.forEach(function(t){t.name===n&&(e=t)}),e?(r.dev=e,tn._outMap[n]=r,t._orig._impl=r,T(r.clients,t._orig),t._info=r.info,t._receive=function(t){r._receive(t)},t._close=function(){r._close(this)},r.dev.open&&(t._pause(),r.dev.open().then(function(){t._resume()},function(){t._crash()}))):t._break()},tn._openIn=function(t,n){var e,r,o=tn._inMap[n];(o||(o={name:n,clients:[],info:{name:n,manufacturer:tn._allIns[n].manufacturer,version:tn._allIns[n].version,type:"MIDI-in",sysex:tn._sysex,engine:tn._type},_close:function(t){tn._closeIn(t)},_closeAll:i,handle:function(t){for(var n=0;n<this.clients.length;n++){var e=tm([].slice.call(t.data));this.clients[n]._emit(e)}}}),tn._access.inputs.forEach(function(t){t.name===n&&(r=t)}),r)?(o.dev=r,o.dev.onmidimessage=(e=o,function(t){e.handle(t)}),tn._inMap[n]=o,t._orig._impl=o,T(o.clients,t._orig),t._info=o.info,t._close=function(){o._close(this)},o.dev.open&&(t._pause(),o.dev.open().then(function(){t._resume()},function(){t._crash()}))):t._break()},tn._closeOut=function(t){var n=t._impl;w(n.clients,t._orig),n.clients.length||(n.dev&&n.dev.close&&n.dev.close(),n.dev=void 0)},tn._closeIn=function(t){var n=t._impl;w(n.clients,t._orig),n.clients.length||(n.dev&&(n.dev.onmidimessage=null,n.dev.close&&n.dev.close()),n.dev=void 0)},tn._close=function(){tn._unwatch()},tn._watch=function(){tn._access.onstatechange=function(){e=!0,d(function(){e&&(tn._refresh(),e=!1)})}},tn._unwatch=function(){tn._access.onstatechange=void 0}}var tl=function(t){if(!o){var n;n=t,(o=new F)._options=n,o._push(B,[function t(n){for(var e=[],i=function t(n){var e,i,r,o=["node","extension","plugin","webmidi"];if(!n||!n.engine)return o;var s=n.engine instanceof Array?n.engine:[n.engine],u={},a=[],f=[];for(r=0;r<s.length;r++){var h=s[r].toString().toLowerCase();u[h]||(u[h]=!0,"none"===h&&(e=!0),("etc"===h||void 0===h)&&(i=!0),i?f.push(h):a.push(h),w(o,h))}return(i||a.length||f.length)&&(e=!1),e?[]:a.concat(i?o:f)}(n),r=0;r<i.length;r++)"webmidi"==i[r]?(n&&!0===n.sysex&&e.push(tu),n&&!0===n.sysex&&!0!==n.degrade||e.push(ts)):"node"==i[r]?(e.push(ti),e.push(tf)):"extension"==i[r]?e.push(ta):"plugin"==i[r]&&e.push(tr);return e.push(th),e}(n)]),o.refresh(),o._resume()}return o._thenable()};function tp(){var t=this instanceof tp?this:t=new tp;return tp.prototype.reset.apply(t,arguments),t}function td(){29.97==this.type&&!this.second&&this.frame<2&&this.minute%10&&(this.frame=2)}function t8(t){return[[24,25,29.97,30][t[7]>>1&3],(1&t[7])<<4|t[6],t[5]<<4|t[4],t[3]<<4|t[2],t[1]<<4|t[0]]}function tg(t){return t<10?"0"+t:t}function tx(t){for(var n=[],e=0;e<t.length;e++)n[e]=tg(e?t[e]:31&t[e]);return n.join(":")}function tm(t){var n,e=this instanceof tm?this:e=new tm;if(t instanceof tm)return e._from=t._from.slice(),A(t,function(n){"_from"!=n&&(e[n]=t[n])}),e;if(e._from=[],void 0===t)return e;var i=t instanceof Array?t:arguments;for(n=0;n<i.length;n++)r=i[n],1==n&&(e[0]>=128&&e[0]<=175&&(r=tm.noteValue(r)),e[0]>=192&&e[0]<=207&&(r=tm.programValue(r))),(r!=parseInt(r)||r<0||r>255)&&t0(i[n]),e.push(r);return e}tl.JZZ=tl,tl.version=c,tl.info=function(){return F.prototype.info()},tl.Widget=function t(n){var e=new U;return n instanceof Object&&A(n,function(t){e[t]=n[t]}),e._resume(),e},F.prototype.Widget=tl.Widget,tl.addMidiIn=function(t,n){var e=P(n._info||{});return e.name=t,e.type=e.type||"javascript",e.manufacturer=e.manufacturer||"virtual",e.version=e.version||"0.0",tl.lib.registerMidiIn(t,{_info:function(){return e},_openIn:function(t){t._pause(),t._info=P(e),t._close=function(){n.disconnect(t)},n.connect(t),t._resume()}})},F.prototype.addMidiIn=tl.addMidiIn,tl.addMidiOut=function(t,n){var e=P(n._info||{});return e.name=t,e.type=e.type||"javascript",e.manufacturer=e.manufacturer||"virtual",e.version=e.version||"0.0",tl.lib.registerMidiOut(t,{_info:function(){return e},_openOut:function(t){t._pause(),t._info=P(e),t._close=function(){t.disconnect()},J.apply(t,[n]),t._resume()}})},F.prototype.addMidiOut=tl.addMidiOut,tl.maskMidiIn=function(t){L[t]=!0},F.prototype.maskMidiIn=tl.maskMidiIn,tl.unmaskMidiIn=function(t){delete L[t]},F.prototype.unmaskMidiIn=tl.unmaskMidiIn,tl.maskMidiOut=function(t){D[t]=!0},F.prototype.maskMidiOut=tl.maskMidiOut,tl.unmaskMidiOut=function(t){delete D[t]},F.prototype.unmaskMidiOut=tl.unmaskMidiOut,tp.prototype.reset=function(t){if(t instanceof tp)return this.setType(t.getType()),this.setHour(t.getHour()),this.setMinute(t.getMinute()),this.setSecond(t.getSecond()),this.setFrame(t.getFrame()),this.setQuarter(t.getQuarter()),this;var n=t instanceof Array?t:arguments;return this.setType(n[0]),this.setHour(n[1]),this.setMinute(n[2]),this.setSecond(n[3]),this.setFrame(n[4]),this.setQuarter(n[5]),this},tp.prototype.isFullFrame=function(){return 0==this.quarter||4==this.quarter},tp.prototype.getType=function(){return this.type},tp.prototype.getHour=function(){return this.hour},tp.prototype.getMinute=function(){return this.minute},tp.prototype.getSecond=function(){return this.second},tp.prototype.getFrame=function(){return this.frame},tp.prototype.getQuarter=function(){return this.quarter},tp.prototype.setType=function(t){if(void 0===t||24==t)this.type=24;else if(25==t)this.type=25;else if(29.97==t)this.type=29.97,td.apply(this);else if(30==t)this.type=30;else throw RangeError("Bad SMPTE frame rate: "+t);return this.frame>=this.type&&(this.frame=this.type-1),this},tp.prototype.setHour=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=24)throw RangeError("Bad SMPTE hours value: "+t);return this.hour=t,this},tp.prototype.setMinute=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=60)throw RangeError("Bad SMPTE minutes value: "+t);return this.minute=t,td.apply(this),this},tp.prototype.setSecond=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=60)throw RangeError("Bad SMPTE seconds value: "+t);return this.second=t,td.apply(this),this},tp.prototype.setFrame=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=this.type)throw RangeError("Bad SMPTE frame number: "+t);return this.frame=t,td.apply(this),this},tp.prototype.setQuarter=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=8)throw RangeError("Bad SMPTE quarter frame: "+t);return this.quarter=t,this},tp.prototype.incrFrame=function(){return this.frame++,this.frame>=this.type&&(this.frame=0,this.second++,this.second>=60&&(this.second=0,this.minute++,this.minute>=60&&(this.minute=0,this.hour=this.hour>=23?0:this.hour+1))),td.apply(this),this},tp.prototype.decrFrame=function(){return!this.second&&2==this.frame&&29.97==this.type&&this.minute%10&&(this.frame=0),this.frame--,this.frame<0&&(this.frame=29.97==this.type?29:this.type-1,this.second--,this.second<0&&(this.second=59,this.minute--,this.minute<0&&(this.minute=59,this.hour=this.hour?this.hour-1:23))),this},tp.prototype.incrQF=function(){return this.backwards=!1,this.quarter=this.quarter+1&7,(0==this.quarter||4==this.quarter)&&this.incrFrame(),this},tp.prototype.decrQF=function(){return this.backwards=!0,this.quarter=this.quarter+7&7,(3==this.quarter||7==this.quarter)&&this.decrFrame(),this},tp.prototype.read=function(t){if(t instanceof tm||(t=tm.apply(null,arguments)),240==t[0]&&127==t[1]&&1==t[3]&&1==t[4]&&247==t[9])return this.type=[24,25,29.97,30][t[5]>>5&3],this.hour=31&t[5],this.minute=t[6],this.second=t[7],this.frame=t[8],this.quarter=0,this._=void 0,this._b=void 0,this._f=void 0,!0;if(241==t[0]&&void 0!==t[1]){var n=t[1]>>4,e=15&t[1];return 0==n?7==this._&&(7==this._f&&(this.reset(t8(this._a)),this.incrFrame()),this.incrFrame()):3==n?4==this._&&this.decrFrame():4==n?3==this._&&this.incrFrame():7==n&&0===this._&&(0===this._b&&(this.reset(t8(this._a)),this.decrFrame()),this.decrFrame()),this._a||(this._a=[]),this._a[n]=e,this._f=this._f===n-1||0==n?n:void 0,this._b=this._b===n+1||7==n?n:void 0,this._=n,this.quarter=n,!0}return!1},tp.prototype.toString=function(){return tx([this.hour,this.minute,this.second,this.frame])},tl.SMPTE=tp,F.prototype.SMPTE=tp,tm.prototype=[],tm.prototype.constructor=tm;var tv={};function t_(t){if(t!=parseFloat(t))throw TypeError("Not a number: "+t)}function ty(){}tm.noteValue=function(t){return void 0===t?void 0:tv[t.toString().toLowerCase()]},tm.programValue=function(t){return t},tm.octaveValue=function(t){var n=tv[t.toString().toLowerCase()];return void 0===n&&(n=tv[t.toString().toLowerCase()+"1"]),void 0===n?void 0:n%12},tm.freq=function(t,n){return void 0===n&&(n=440),t_(n),t!=parseFloat(t)&&(t=tw(t)),n*Math.pow(2,(t-69)/12)},tm.shift=function(t,n){return void 0===n&&(n=440),t_(t),t_(n),12*Math.log2(t/n)},tm.midi=function(t,n){return t!=parseFloat(t)?tw(t):tm.shift(t,n)+69},tm.to7b=function(t){return t_(t),t<=0?0:t>=1?127:Math.floor(128*t)},tm.to14b=function(t){return t_(t),t<=0?0:t>=1?16383:Math.floor(16384*t)},tm.to21b=function(t){return void 0===t?2097151:(t_(t),t<=0)?0:(t=(Math.floor(t)<<14)+tm.to14b(t-Math.floor(t)))<2097151?t:2097150},ty.prototype=tm,tm._sxid=127,tm.sxId=function(t){if(void 0===t&&(t=tm._sxid),t==this._sxid)return this;t=tS(t);var n=new ty;return n._ch=this._ch,n._sxid=t,n},tm.ch=function(t){if(t==this._ch||void 0===t&&void 0===this._ch)return this;var n=new ty;return void 0!==t&&(t=tC(t)),n._ch=t,n._sxid=this._sxid,n};var tb={c:0,d:2,e:4,f:5,g:7,a:9,b:11,h:11};for(A(tb,function(t){for(r=0;r<12&&!((i=tb[t]+12*r)>127);r++)tv[t+r]=i,tv[t+"♮"+r]=i,i>0&&(tv[t+"b"+r]=i-1,tv[t+"♭"+r]=i-1,tv[t+"bb"+r]=i-2,tv[t+"♭♭"+r]=i-2,tv[t+"\uD834\uDD2B"+r]=i-2),i<127&&(tv[t+"#"+r]=i+1,tv[t+"♯"+r]=i+1,tv[t+"##"+r]=i+2,tv[t+"♯♯"+r]=i+2,tv[t+"\uD834\uDD2A"+r]=i+2)}),r=0;r<128;r++)tv[r]=r;function t0(t){throw RangeError("Bad MIDI value: "+t)}function tM(t){throw TypeError("Invalid value: "+t)}function tC(t){return Q(t),parseInt(t)}function tS(t,n){return(t!=parseInt(t)||t<0||t>127)&&t0(void 0===n?t:n),parseInt(t)}function t2(t){return(t!=parseInt(t)||t<0||t>255)&&t0(t),parseInt(t)}function tB(t){return(t!=parseInt(t)||t<0||t>16383)&&t0(t),parseInt(t)}function tT(t){if(t!=parseInt(t)||t<0||t>65535)throw RangeError("Expected a 16-bit value: "+t);return parseInt(t)}function tw(t){return tS(tm.noteValue(t),t)}function t5(t){return 127&tB(t)}function tF(t){return tB(t)>>7}function t6(t){return[t>>14,t>>7&127,127&t]}function t1(t,n){return t!=parseFloat(t)&&tM(void 0===n?t:n),(t<0||t>1)&&function t(n){throw RangeError("Out of range: "+n)}(void 0===n?t:n),parseFloat(t)}function tA(t){return void 0===t||t?127:126}function t4(t){var n,e,i=[],r={};A(t,function(n){var o;if(e=(((o=t[n])!=parseInt(o)||o<0||o>2097151)&&t0(o),parseInt(o)),(n=tw(n))in r)throw RangeError("Duplicate MIDI value: "+n);i.push(n),r[n]=e}),i.sort();var o=[i.length];for(n=0;n<i.length;n++)o=o.concat([i[n]],t6(r[i[n]]));return o}function tP(t){var n={};return A(t,function(e){n[e]=tm.to21b(t[e]==parseFloat(t[e])?t[e]:tw(t[e]))}),n}function tO(t){var n={};return A(t,function(e){n[e]=tm.to21b(tm.midi(t[e]))}),n}var tI={noteOff:function(t,n,e){return void 0===e&&(e=64),[128+tC(t),tw(n),tS(e)]},noteOn:function(t,n,e){return void 0===e&&(e=127),[144+tC(t),tw(n),tS(e)]},aftertouch:function(t,n,e){return[160+tC(t),tw(n),tS(e)]}},t3={control:function(t,n,e){return[176+tC(t),tS(n),tS(e)]},program:function(t,n){return[192+tC(t),tS(tm.programValue(n),n)]},pressure:function(t,n){return[208+tC(t),tS(n)]},pitchBend:function(t,n,e){return void 0===e?[224+tC(t),t5(n),tF(n)]:[224+tC(t),tS(e),tS(n)]},pitchBendF:function(t,n){return t3.pitchBend(t,tm.to14b((n+1)/2))},bankMSB:function(t,n){return[176+tC(t),0,tS(n)]},bankLSB:function(t,n){return[176+tC(t),32,tS(n)]},modMSB:function(t,n){return[176+tC(t),1,tS(n)]},modLSB:function(t,n){return[176+tC(t),33,tS(n)]},breathMSB:function(t,n){return[176+tC(t),2,tS(n)]},breathLSB:function(t,n){return[176+tC(t),34,tS(n)]},footMSB:function(t,n){return[176+tC(t),4,tS(n)]},footLSB:function(t,n){return[176+tC(t),36,tS(n)]},portamentoMSB:function(t,n){return[176+tC(t),5,tS(n)]},portamentoLSB:function(t,n){return[176+tC(t),37,tS(n)]},dataMSB:function(t,n){return[176+tC(t),6,tS(n)]},dataLSB:function(t,n){return[176+tC(t),38,tS(n)]},volumeMSB:function(t,n){return[176+tC(t),7,tS(n)]},volumeLSB:function(t,n){return[176+tC(t),39,tS(n)]},balanceMSB:function(t,n){return[176+tC(t),8,tS(n)]},balanceLSB:function(t,n){return[176+tC(t),40,tS(n)]},panMSB:function(t,n){return[176+tC(t),10,tS(n)]},panLSB:function(t,n){return[176+tC(t),42,tS(n)]},expressionMSB:function(t,n){return[176+tC(t),11,tS(n)]},expressionLSB:function(t,n){return[176+tC(t),43,tS(n)]},damper:function(t,n){return void 0===n&&(n=!0),[176+tC(t),64,n?127:0]},portamento:function(t,n){return void 0===n&&(n=!0),[176+tC(t),65,n?127:0]},sostenuto:function(t,n){return void 0===n&&(n=!0),[176+tC(t),66,n?127:0]},soft:function(t,n){return void 0===n&&(n=!0),[176+tC(t),67,n?127:0]},legato:function(t,n){return void 0===n&&(n=!0),[176+tC(t),68,n?127:0]},hold2:function(t,n){return void 0===n&&(n=!0),[176+tC(t),69,n?127:0]},soundVariation:function(t,n){return[176+tC(t),70,tw(n)]},filterResonance:function(t,n){return[176+tC(t),71,tw(n)]},releaseTime:function(t,n){return[176+tC(t),72,tw(n)]},attackTime:function(t,n){return[176+tC(t),73,tw(n)]},brightness:function(t,n){return[176+tC(t),74,tw(n)]},decayTime:function(t,n){return[176+tC(t),75,tw(n)]},vibratoRate:function(t,n){return[176+tC(t),76,tw(n)]},vibratoDepth:function(t,n){return[176+tC(t),77,tw(n)]},vibratoDelay:function(t,n){return[176+tC(t),78,tw(n)]},ptc:function(t,n){return[176+tC(t),84,tw(n)]},dataIncr:function(t){return[176+tC(t),96,0]},dataDecr:function(t){return[176+tC(t),97,0]},nrpnLSB:function(t,n){return[176+tC(t),98,tS(n)]},nrpnMSB:function(t,n){return[176+tC(t),99,tS(n)]},rpnLSB:function(t,n){return[176+tC(t),100,tS(n)]},rpnMSB:function(t,n){return[176+tC(t),101,tS(n)]},allSoundOff:function(t){return[176+tC(t),120,0]},resetAllControllers:function(t){return[176+tC(t),121,0]},localControl:function(t,n){return void 0===n&&(n=!0),[176+tC(t),122,n?127:0]},allNotesOff:function(t){return[176+tC(t),123,0]},omni:function(t,n){return void 0===n&&(n=!0),[176+tC(t),n?125:124,0]},mono:function(t,n){return void 0===n&&(n=1),[176+tC(t),126,tS(n)]},poly:function(t){return[176+tC(t),127,0]}};function tE(t,n,e,i){return void 0!==n?[tS(t),tS(n),tS(e),tS(i)]:((t!=parseInt(t)||t<0||r>65535)&&tM(t),[(t=parseInt(t))>>12&15,t>>8&15,t>>4&15,15&t])}function tk(t){return t_(t),Math.round(1e3*t+1024)}var t7={mtc:function(t){return[241,function t(n){var e;switch(!n.backwards&&n.quarter>=4?n.decrFrame():n.backwards&&n.quarter<4&&n.incrFrame(),n.quarter>>1){case 0:e=n.frame;break;case 1:e=n.second;break;case 2:e=n.minute;break;default:e=n.hour}return 1&n.quarter?e>>=4:e&=15,7==n.quarter&&(25==n.type?e|=2:29.97==n.type?e|=4:30==n.type&&(e|=6)),!n.backwards&&n.quarter>=4?n.incrFrame():n.backwards&&n.quarter<4&&n.decrFrame(),e|n.quarter<<4}(t)]},songPosition:function(t,n){return void 0===n?[242,t5(t),tF(t)]:[242,tS(n),tS(t)]},songSelect:function(t){return[243,tS(t)]},tune:function(){return[246]},clock:function(){return[248]},start:function(){return[250]},continue:function(){return[251]},stop:function(){return[252]},active:function(){return[254]},reset:function(){return[255]}},tD={sxIdRequest:function(){return[240,126,this._sxid,6,1,247]},sxTuningDumpRequest:function(t,n){return void 0===n?[240,126,this._sxid,8,0,tS(t),247]:[240,126,this._sxid,8,3,tS(t),tS(n),247]},sxFullFrame:function(t){var n;return[240,127,this._sxid,1,1,25==(n=t).type?32|n.hour:29.97==n.type?64|n.hour:30==n.type?96|n.hour:n.hour,t.getMinute(),t.getSecond(),t.getFrame(),247]},sxMasterVolume:function(t,n){return void 0===n?[240,127,this._sxid,4,1,t5(t),tF(t),247]:[240,127,this._sxid,4,1,tS(n),tS(t),247]},sxMasterVolumeF:function(t){return tD.sxMasterVolume.call(this,tm.to14b(t1(t)))},sxMasterFineTuning:function(t,n){return void 0===n?[240,127,this._sxid,4,3,t5(t),tF(t),247]:[240,127,this._sxid,4,3,tS(n),tS(t),247]},sxMasterFineTuningF:function(t){return tD.sxMasterFineTuning.call(this,tm.to14b(t1((t%1+1)/2,t)))},sxMasterCoarseTuning:function(t){return[240,127,this._sxid,4,4,0,tS(t),247]},sxMasterCoarseTuningF:function(t){return tD.sxMasterCoarseTuning.call(this,64+(t-t%1))},sxNoteTuning:function(t,n,e,i){return n==parseInt(n)?[240,tA(i),this._sxid,8,7,tS(t),tS(n)].concat(t4(e),[247]):[240,127,this._sxid,8,2,tS(t)].concat(t4(n),[247])},sxNoteTuningF:function(t,n,e,i){return n==parseInt(n)?tD.sxNoteTuning.call(this,t,n,tP(e),i):tD.sxNoteTuning.call(this,t,tP(n))},sxNoteTuningHZ:function(t,n,e,i){return n==parseInt(n)?tD.sxNoteTuning.call(this,t,n,tO(e),i):tD.sxNoteTuning.call(this,t,tO(n))},sxScaleTuning1:function(t,n,e){return t==parseInt(t)?[240,tA(e),this._sxid,8,8].concat(t6(tT(t)),function t(n){var e=[];if(!(n instanceof Array)||12!=n.length)throw TypeError("Expected an array of size 12");for(var i=0;i<12;i++)e.push(tS(n[i]));return e}(n),[247]):tD.sxScaleTuning1.call(this,65535,t,n)},sxScaleTuning1F:function(t,n,e){if(t!=parseInt(t))return tD.sxScaleTuning1F.call(this,65535,t,n);for(var i=[],r=0;r<n.length;r++){if(n[r]<-.64||n[r]>.63)throw RangeError("Out of range: "+n[r]);i.push(Math.floor(100*n[r]+64))}return tD.sxScaleTuning1.call(this,t,i,e)},sxScaleTuning2:function(t,n,e){return t==parseInt(t)?[240,tA(e),this._sxid,8,9].concat(t6(tT(t)),function t(n){var e=[];if(!(n instanceof Array)||12!=n.length)throw TypeError("Expected an array of size 12");for(var i=0;i<12;i++)e.push(tF(n[i])),e.push(t5(n[i]));return e}(n),[247]):tD.sxScaleTuning2.call(this,65535,t,n)},sxScaleTuning2F:function(t,n,e){if(t!=parseInt(t))return tD.sxScaleTuning2F.call(this,65535,t,n);for(var i=[],r=0;r<n.length;r++){var o=(n[r]+1)/2;if(o<-1||o>1)throw RangeError("Out of range: "+n[r]);i.push(tm.to14b((n[r]+1)/2))}return tD.sxScaleTuning2.call(this,t,i,e)},sxGM:function(t){return void 0===t&&(t=1),[240,126,this._sxid,9,t?2==t?3:1:2,247]},sxGS:function(t){for(var n=void 0===t?[64,0,127,0]:t instanceof Array?t:arguments,e=0,i=[240,65,this._sxid,66,18],r=0;r<n.length;r++){var o=tS(n[r]);i.push(o),e+=o}return e%=128,i.push(e?128-e:0),i.push(247),i},sxXG:function(t){var n=void 0===t?[0,0,126,0]:t instanceof Array?t:arguments,e=127==this._sxid?0:this._sxid;e>15&&t0("Bad Yamaha device number: "+e);for(var i=[240,67,16+e,76],r=0;r<n.length;r++)i.push(tS(n[r]));return i.push(247),i},sxMidiSoft:function(t,n){var e=[240,0,32,36,0,tS(t||0)];n=void 0===n?"":""+n;for(var i=0;i<n.length;i++)e.push(tS(n.charCodeAt(i)));return e.push(247),e},gsMasterVolume:function(t){return tD.sxGS.call(this,[64,0,4,tS(t)])},gsMasterVolumeF:function(t){return tD.gsMasterVolume.call(this,tm.to7b(t1(t)))},gsMasterFineTuning:function(t,n,e,i){return t=tE(t,n,e,i),tD.sxGS.call(this,[64,0,0,t[0],t[1],t[2],t[3]])},gsMasterFineTuningF:function(t){return tD.gsMasterFineTuning.call(this,tk(t%1))},gsMasterCoarseTuning:function(t){return tD.sxGS.call(this,[64,0,5,tS(t)])},gsMasterCoarseTuningF:function(t){return tD.gsMasterCoarseTuning.call(this,64+(t-t%1))},gsOctaveTuning:function(t,n,e){return tD.sxGS.call(this,[64,16+[1,2,3,4,5,6,7,8,9,0,11,12,13,14,15][tC(t)],64+tm.octaveValue(n),tS(e)])},gsOctaveTuningF:function(t,n,e){if(e<-.64||e>.63)throw RangeError("Out of range: "+e);return tD.gsOctaveTuning.call(this,t,n,Math.floor(100*e+64))},xgMasterVolume:function(t){return tD.sxXG.call(this,[0,0,4,tS(t)])},xgMasterVolumeF:function(t){return tD.xgMasterVolume.call(this,tm.to7b(t1(t)))},xgMasterFineTuning:function(t,n,e,i){return t=tE(t,n,e,i),tD.sxXG.call(this,[0,0,0,t[0],t[1],t[2],t[3]])},xgMasterFineTuningF:function(t){return tD.xgMasterFineTuning.call(this,tk(t%1))},xgMasterCoarseTuning:function(t){return tD.sxXG.call(this,[0,0,6,tS(t)])},xgMasterCoarseTuningF:function(t){return tD.xgMasterCoarseTuning.call(this,64+(t-t%1))},xgOctaveTuning:function(t,n,e){return tD.sxXG.call(this,[8,tC(t),65+tm.octaveValue(n),tS(e)])},xgOctaveTuningF:function(t,n,e){if(e<-.64||e>.63)throw RangeError("Out of range: "+e);return tD.xgOctaveTuning.call(this,t,n,Math.floor(100*e+64))}};tD.sxScaleTuning=tD.sxScaleTuning2,tD.sxScaleTuningF=tD.sxScaleTuning2F,tD.sxMasterTranspose=tD.sxMasterCoarseTuning,tD.sxMasterTransposeF=tD.sxMasterCoarseTuningF,tD.gsMasterTranspose=tD.gsMasterCoarseTuning,tD.gsMasterTransposeF=tD.gsMasterCoarseTuningF,tD.xgMasterTranspose=tD.xgMasterCoarseTuning,tD.xgMasterTransposeF=tD.xgMasterCoarseTuningF;var tL={bank:function(t,n,e){return void 0===e?[t3.bankMSB(t,tF(n)),t3.bankLSB(t,t5(n))]:[t3.bankMSB(t,n),t3.bankLSB(t,e)]},modF:function(t,n){return tL.mod(t,tm.to14b(n))},mod:function(t,n,e){return void 0===e?[t3.modMSB(t,tF(n)),t3.modLSB(t,t5(n))]:[t3.modMSB(t,n),t3.modLSB(t,e)]},breathF:function(t,n){return tL.breath(t,tm.to14b(n))},breath:function(t,n,e){return void 0===e?[t3.breathMSB(t,tF(n)),t3.breathLSB(t,t5(n))]:[t3.breathMSB(t,n),t3.breathLSB(t,e)]},footF:function(t,n){return tL.foot(t,tm.to14b(n))},foot:function(t,n,e){return void 0===e?[t3.footMSB(t,tF(n)),t3.footLSB(t,t5(n))]:[t3.footMSB(t,n),t3.footLSB(t,e)]},portamentoTimeF:function(t,n){return tL.portamentoTime(t,tm.to14b(n))},portamentoTime:function(t,n,e){return void 0===e?[t3.portamentoMSB(t,tF(n)),t3.portamentoLSB(t,t5(n))]:[t3.portamentoMSB(t,n),t3.portamentoLSB(t,e)]},dataF:function(t,n){return tL.data(t,tm.to14b(n))},data:function(t,n,e){return void 0===e?[t3.dataMSB(t,tF(n)),t3.dataLSB(t,t5(n))]:[t3.dataMSB(t,n),t3.dataLSB(t,e)]},volumeF:function(t,n){return tL.volume(t,tm.to14b(n))},volume:function(t,n,e){return void 0===e?[t3.volumeMSB(t,tF(n)),t3.volumeLSB(t,t5(n))]:[t3.volumeMSB(t,n),t3.volumeLSB(t,e)]},balanceF:function(t,n){return tL.balance(t,tm.to14b((n+1)/2))},balance:function(t,n,e){return void 0===e?[t3.balanceMSB(t,tF(n)),t3.balanceLSB(t,t5(n))]:[t3.balanceMSB(t,n),t3.balanceLSB(t,e)]},panF:function(t,n){return tL.pan(t,tm.to14b((n+1)/2))},pan:function(t,n,e){return void 0===e?[t3.panMSB(t,tF(n)),t3.panLSB(t,t5(n))]:[t3.panMSB(t,n),t3.panLSB(t,e)]},expressionF:function(t,n){return tL.expression(t,tm.to14b(n))},expression:function(t,n,e){return void 0===e?[t3.expressionMSB(t,tF(n)),t3.expressionLSB(t,t5(n))]:[t3.expressionMSB(t,n),t3.expressionLSB(t,e)]},nrpn:function(t,n,e){return void 0===e?[t3.nrpnMSB(t,tF(n)),t3.nrpnLSB(t,t5(n))]:[t3.nrpnMSB(t,n),t3.nrpnLSB(t,e)]},rpn:function(t,n,e){return void 0===e?[t3.rpnMSB(t,tF(n)),t3.rpnLSB(t,t5(n))]:[t3.rpnMSB(t,n),t3.rpnLSB(t,e)]},rpnPitchBendRange:function(t,n,e){return tL.rpn(t,0,0).concat(tL.data(t,n,e))},rpnPitchBendRangeF:function(t,n){return tL.rpnPitchBendRange(t,tS(n-n%1),Math.floor(n%1*100))},rpnFineTuning:function(t,n,e){return tL.rpn(t,0,1).concat(tL.data(t,n,e))},rpnFineTuningF:function(t,n){return tL.rpn(t,0,1).concat(tL.dataF(t,(n%1+1)/2))},rpnCoarseTuning:function(t,n){return tL.rpn(t,0,2).concat([t3.dataMSB(t,n)])},rpnCoarseTuningF:function(t,n){return tL.rpn(t,0,2).concat([t3.dataMSB(t,64+(n-n%1))])},rpnTuning:function(t,n,e,i){return tL.rpnCoarseTuning(t,n).concat(tL.rpnFineTuning(t,e,i))},rpnTuningF:function(t,n){return tL.rpnCoarseTuningF(t,n).concat(tL.rpnFineTuningF(t,n))},rpnTuningA:function(t,n){return tL.rpnTuningF(t,tm.shift(n))},rpnSelectTuningProgram:function(t,n){return tL.rpn(t,0,3).concat([t3.dataMSB(t,n)])},rpnSelectTuningBank:function(t,n){return tL.rpn(t,0,4).concat([t3.dataMSB(t,n)])},rpnSelectTuning:function(t,n,e){return void 0===e?tL.rpnSelectTuningProgram(t,n):tL.rpnSelectTuningBank(t,n).concat(tL.rpnSelectTuningProgram(t,e))},rpnModulationDepthRange:function(t,n,e){return tL.rpn(t,0,5).concat(tL.data(t,n,e))},rpnModulationDepthRangeF:function(t,n){return tL.rpnModulationDepthRange(t,tS(n-n%1),Math.floor(n%1*128))},rpnNull:function(t){return tL.rpn(t,127,127)},mode1:function(t){return[t3.omni(t,!0),t3.poly(t)]},mode2:function(t){return[t3.omni(t,!0),t3.mono(t)]},mode3:function(t){return[t3.omni(t,!1),t3.poly(t)]},mode4:function(t){return[t3.omni(t,!1),t3.mono(t)]}},tN={sxMasterTuning:function(t,n,e){return[tD.sxMasterCoarseTuning.call(this,t),tD.sxMasterFineTuning.call(this,n,e)]},sxMasterTuningF:function(t){return[tD.sxMasterCoarseTuningF.call(this,t),tD.sxMasterFineTuningF.call(this,t)]},gsMasterTuningF:function(t){return[tD.gsMasterCoarseTuningF.call(this,t),tD.gsMasterFineTuningF.call(this,t)]},xgMasterTuningF:function(t){return[tD.xgMasterCoarseTuningF.call(this,t),tD.xgMasterFineTuningF.call(this,t)]},sxMasterTuningA:function(t){return tN.sxMasterTuningF.call(this,tm.shift(t))},gsMasterTuningA:function(t){return tN.gsMasterTuningF.call(this,tm.shift(t))},xgMasterTuningA:function(t){return tN.xgMasterTuningF.call(this,tm.shift(t))},gsScaleTuning:function(t,n){var e=[];if(12!=n.length)throw RangeError("Wrong input size: "+n.length);for(var i=0;i<12;i++)e.push(tD.gsOctaveTuning.call(this,t,i,n[i]));return e},gsScaleTuningF:function(t,n){var e=[];if(12!=n.length)throw RangeError("Wrong input size: "+n.length);for(var i=0;i<12;i++)e.push(tD.gsOctaveTuningF.call(this,t,i,n[i]));return e},xgScaleTuning:function(t,n){var e=[];if(12!=n.length)throw RangeError("Wrong input size: "+n.length);for(var i=0;i<12;i++)e.push(tD.xgOctaveTuning.call(this,t,i,n[i]));return e},xgScaleTuningF:function(t,n){var e=[];if(12!=n.length)throw RangeError("Wrong input size: "+n.length);for(var i=0;i<12;i++)e.push(tD.xgOctaveTuningF.call(this,t,i,n[i]));return e}};function tG(t,n){var e=new tm;return e.ff=t2(t),e.dd=void 0===n?"":function t(n){n=""+n;for(var e=0;e<n.length;e++)n.charCodeAt(e)>255&&t0(n[e]);return n}(n),e}var tq={smf:function(t){if(t instanceof tm)return new tm(t);var n=t instanceof Array?t:arguments,e=t2(n[0]),i="";return 2==n.length?i=tW(n[1]):n.length>2&&(i=tW(Array.prototype.slice.call(n,1))),tG(e,i)},smfSeqNumber:function(t){if(t==parseInt(t)){if(t<0||t>65535)throw RangeError("Sequence number out of range: "+t);t=String.fromCharCode(t>>8)+String.fromCharCode(255&t)}else if(0==(t=""+t).length)t="\0\0";else if(1==t.length)t="\0"+t;else if(t.length>2)throw RangeError("Sequence number out of range"+tK(t));return tG(0,t)},smfText:function(t){return tG(1,tl.lib.toUTF8(t))},smfCopyright:function(t){return tG(2,tl.lib.toUTF8(t))},smfSeqName:function(t){return tG(3,tl.lib.toUTF8(t))},smfInstrName:function(t){return tG(4,tl.lib.toUTF8(t))},smfLyric:function(t){return tG(5,tl.lib.toUTF8(t))},smfMarker:function(t){return tG(6,tl.lib.toUTF8(t))},smfCuePoint:function(t){return tG(7,tl.lib.toUTF8(t))},smfProgName:function(t){return tG(8,tl.lib.toUTF8(t))},smfDevName:function(t){return tG(9,tl.lib.toUTF8(t))},smfChannelPrefix:function(t){if(t==parseInt(t))Q(t),t=String.fromCharCode(t);else if(0==(t=""+t).length)t="\0";else if(t.length>1||t.charCodeAt(0)>15)throw RangeError("Channel number out of range"+tK(t));return tG(32,t)},smfMidiPort:function(t){if(t==parseInt(t)){if(t<0||t>127)throw RangeError("Port number out of range: "+t);t=String.fromCharCode(t)}else if(0==(t=""+t).length)t="\0";else if(t.length>1||t.charCodeAt(0)>127)throw RangeError("Port number out of range"+tK(t));return tG(33,t)},smfEndOfTrack:function(t){if(""!=tW(t))throw RangeError("Unexpected data"+tK(tW(t)));return tG(47)},smfTempo:function(t){if(3==(""+t).length)return tG(81,t);if(t==parseInt(t)&&t>0&&t<=16777215)return tG(81,String.fromCharCode(t>>16)+String.fromCharCode(t>>8&255)+String.fromCharCode(255&t));throw RangeError("Out of range"+tK(tW(t)))},smfBPM:function(t){return tq.smfTempo(Math.round(6e7/t))},smfSMPTE:function(t){if(t instanceof tp)return tG(84,String.fromCharCode(t.hour)+String.fromCharCode(t.minute)+String.fromCharCode(t.second)+String.fromCharCode(t.frame)+String.fromCharCode(t.quarter%4*25));if(5==(""+t).length)return tG(84,t);var n=t instanceof Array?t:Array.prototype.slice.call(arguments);return n.splice(0,0,30),tq.smfSMPTE(new tp(n))},smfTimeSignature:function(t,n,e,i){var r,o,s,u,a=(""+t).match(/^\s*(\d+)\s*\/\s*(\d+)\s*$/);if(a){if(r=parseInt(a[1]),o=parseInt(a[2]),r>0&&r<256&&o>0&&!(o&o-1)){for(s=o,o=0,s>>=1;s;s>>=1)o++;return s=n==parseInt(n)?n:24,u=e==parseInt(e)?e:8,tG(88,String.fromCharCode(r)+String.fromCharCode(o)+String.fromCharCode(s)+String.fromCharCode(u))}if(4==(""+t).length)return tG(88,t)}else if(t==parseInt(t)&&n==parseInt(n)){if(t>0&&t<256&&n>0&&!(n&n-1)){for(r=t,o=0,s=n,s>>=1;s;s>>=1)o++;return s=e==parseInt(e)?e:24,u=i==parseInt(i)?i:8,tG(88,String.fromCharCode(r)+String.fromCharCode(o)+String.fromCharCode(s)+String.fromCharCode(u))}if(4==(""+t).length)return tG(88,t);t=t+"/"+n}else if(4==(""+t).length)return tG(88,t);throw RangeError("Wrong time signature"+tK(tW(""+t)))},smfKeySignature:function(t){var n=(t=""+t).match(/^\s*([A-H][b#]?)\s*(|maj|major|dur|m|min|minor|moll)\s*$/i);if(n){var e={CB:0,GB:1,DB:2,AB:3,EB:4,BB:5,F:6,C:7,G:8,D:9,A:10,E:11,B:12,H:12,"F#":13,"C#":14,"G#":15,"D#":16,"A#":17}[n[1].toUpperCase()],i={"":0,MAJ:0,MAJOR:0,DUR:0,M:1,MIN:1,MINOR:1,MOLL:1}[n[2].toUpperCase()];void 0!==e&&void 0!==i&&(i&&(e-=3),(e-=7)>=-7&&e<0?t=String.fromCharCode(256+e)+String.fromCharCode(i):e>=0&&e<=7&&(t=String.fromCharCode(e)+String.fromCharCode(i)))}if(2==t.length&&1>=t.charCodeAt(1)&&(7>=t.charCodeAt(0)||255>=t.charCodeAt(0)&&t.charCodeAt(0)>=249))return tG(89,t);throw RangeError("Incorrect key signature"+tK(t))},smfSequencer:function(t){return tG(127,tW(t))}},tz={};function tR(t,n){tm[t]=function(){return new tm(n.apply(this,arguments))},tz[t]=function(){return this.send(n.apply(this,arguments))}}function tV(t){A(tz,function(n){t.prototype[n]=tz[n]})}A(t7,function(t){tR(t,t7[t])}),A(tD,function(t){tR(t,tD[t])}),A(tq,function(t){var n,e;n=t,e=tq[t],tm[n]=function(){return e.apply(this,arguments)},tz[n]=function(){return this.send(e.apply(this,arguments))}}),A(tN,function(t){var n,e;n=t,e=tN[t],tm[n]=function(){var t,n=[],i=e.apply(this,arguments);for(t=0;t<i.length;t++)n.push(new tm(i[t]));return n},tz[n]=function(){for(var t=e.apply(this,arguments),n=this,i=0;i<t.length;i++)n=n.send(t[i]);return n}}),A(tI,function(t){var n,e;n=t,e=tI[t],tm[n]=function(){return new tm(e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))))},tz[n]=function(){if(void 0!==this._master){var t=new tm(e.apply(this,[this._master].concat(Array.prototype.slice.call(arguments))));return t._mpe=t[1],this.send(t)}return this.send(e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))))}}),A(t3,function(t){var n,e;n=t,e=t3[t],tm[n]=function(){return new tm(e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))))},tz[n]=function(){if(void 0!==this._master){var t,n=Array.prototype.slice.call(arguments);n.length<e.length?n=[this._master].concat(n):(t=tw(n[0]),n[0]=this._master);var i=new tm(e.apply(this,n));return i._mpe=t,this.send(i)}return this.send(e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))))}}),A(tL,function(t){var n,e;n=t,e=tL[t],tm[n]=function(){var t,n=[],i=e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments)));for(t=0;t<i.length;t++)n.push(new tm(i[t]));return n},tz[n]=function(){if(void 0!==this._master){var t,n,i,r,o=Array.prototype.slice.call(arguments);for(o.length<e.length?o=[this._master].concat(o):(r=tw(o[0]),o[0]=this._master),n=e.apply(this,o),i=this,t=0;t<n.length;t++){var s=tm(n[t]);s._mpe=r,i=i.send(s)}return i}for(t=0,n=e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))),i=this;t<n.length;t++)i=i.send(n[t]);return i}}),tV(U);var tj={a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15};for(e=0;e<16;e++)tj[e]=e;function tU(t){for(var n=[],e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}function tW(t){return t instanceof Array?function t(n){for(var e="",i=0;i<n.length;i++)e+=String.fromCharCode(n[i]);return e}(t):void 0===t?"":""+t}function tZ(t){return(t<16?"0":"")+t.toString(16)}function tJ(t){for(var n=[],e=0;e<t.length;e++)n.push(tZ(t[e]));return n.join(" ")}function tX(t){for(var n=[],e=0;e<t.length;e++)e&&e%4==0&&n.push(" "),n.push(tZ(t[e]));return n.join("")}function tH(t){for(var n="",e=0;e<t.length;e++)"\n"==t[e]?n+="\\n":"\r"==t[e]?n+="\\r":"	"==t[e]?n+="\\t":32>t.charCodeAt(e)?n+="\\x"+tZ(t.charCodeAt(e)):n+=t[e];return n}function tQ(t){return t.length?": "+tJ(tU(t)):""}function tK(t){return t.length?": "+tH(tl.lib.fromUTF8(t)):""}function tY(){var t;for(t=0,this._cc=[];t<16;t++)this._cc[t]={}}function t9(t){if(!t.length||t[0]<128)return t;if(255==t[0])return this._clear(),t;var n,e,i,r,o,s,u,a,f,h,c=15&t[0],$=t[0]>>4;if(12==$)t._bm=this._cc[c].bm,t._bl=this._cc[c].bl,tl.MIDI.programName&&t.label(tl.MIDI.programName(t[1],t._bm,t._bl));else if(11==$)switch(t[1]){case 0:this._cc[c].bm=t[2];break;case 32:this._cc[c].bl=t[2];break;case 98:this._cc[c].nl=t[2],this._cc[c].rn="n";break;case 99:this._cc[c].nm=t[2],this._cc[c].rn="n";break;case 100:this._cc[c].rl=t[2],this._cc[c].rn="r";break;case 101:this._cc[c].rm=t[2],this._cc[c].rn="r";break;case 6:case 38:case 96:case 97:"r"==this._cc[c].rn&&(t._rm=this._cc[c].rm,t._rl=this._cc[c].rl,t.label((n=this._cc[c].rm,e=this._cc[c].rl,i=void 0===n?"??":tZ(n),o=({0:"Pitch Bend Sensitivity",1:"Channel Fine Tune",2:"Channel Coarse Tune",3:"Select Tuning Program",4:"Select Tuning Bank",5:"Vibrato Depth Range","7f7f":"NONE"})[i+""+(r=void 0===e?"??":tZ(e))],"RPN "+i+" "+r+(o?": "+o:"")))),"n"==this._cc[c].rn&&(t._nm=this._cc[c].rm,t._nl=this._cc[c].nl,t.label((s=this._cc[c].nm,u=this._cc[c].nl,a=void 0===s?"??":tZ(s),"NRPN "+a+" "+(f=void 0===u?"??":tZ(u)))))}else t.isFullSysEx()&&(127==t[1]?4==t[3]?(h=({1:"Master Volume",2:"Master Balance",3:"Master Fine Tuning",4:"Master Coarse Tuning"})[t[4]])&&t.label(h):8==t[3]&&(h=({2:"Note Tuning",7:"Note Tuning, Bank",8:"Scale Tuning, 1 byte format",9:"Scale Tuning, 2 byte format"})[t[4]])&&t.label(h):126==t[1]?6==t[3]?1==t[4]?t.label("Device ID Request"):2==t[4]&&t.label("Device ID Response"):8==t[3]?(h=({0:"Bulk Tuning Dump Request",1:"Bulk Tuning Dump",3:"Bulk Tuning Dump Request, Bank",4:"Bulk Tuning Dump, Bank",5:"Scale Tuning Dump, 1 byte format",6:"Scale Tuning Dump, 2 byte format",7:"Note Tuning, Bank",8:"Scale Tuning, 1 byte format",9:"Scale Tuning, 2 byte format"})[t[4]])&&t.label(h):9==t[3]&&(1==t[4]?(t.label("GM1 System On"),this._clear(),this._gm="1"):2==t[4]?(t.label("GM System Off"),this._clear(),this._gm="0"):3==t[4]&&(t.label("GM2 System On"),this._clear(),this._gm="2")):67==t[1]?(240&t[2])==16&&76==t[3]&&(0==t[4]&&0==t[5]&&126==t[6]&&0==t[7]?(t.label("XG System On"),this._clear(),this._gm="Y"):0==t[4]&&0==t[5]&&0==t[6]?t.label("XG Master Tuning"):0==t[4]&&0==t[5]&&4==t[6]?t.label("XG Master Volume"):0==t[4]&&0==t[5]&&6==t[6]?t.label("XG Master Transpose"):8==t[4]&&t[5]<16&&t[6]>=65&&t[6]<=76?t.label("XG Scale Tuning"):t.label("XG Parameter")):65==t[1]&&66==t[3]&&18==t[4]&&(64==t[5]&&(0==t[6]?127==t[7]&&0==t[8]&&65==t[9]?(t.label("GS Reset"),this._clear(),this._gm="R"):0==t[7]?t.label("GS Master Tuning"):4==t[7]?t.label("GS Master Volume"):5==t[7]?t.label("GS Master Transpose"):t.label("GS Parameter"):(240&t[6])==16&&21==t[7]?t.label("GS Drum Part Change"):(240&t[6])==16&&t[7]>=64&&t[7]<=75?t.label("GS Scale Tuning"):t.label("GS Parameter")),65==t[5]&&t.label("GS Parameter")));return t}function nt(){var t=new U;return t._clear=tY,t._read=t9,t._receive=function(t){this._emit(this._read(t))},t._clear(),t._resume(),t}function nn(){var t=this instanceof nn?this:t=new nn;return t.reset(),arguments.length&&nn.prototype.setup.apply(t,arguments),t}function ne(t){var n,e=this instanceof ne?this:e=new ne;if(t instanceof ne)return e._from=t._from.slice(),A(t,function(n){"_from"!=n&&(e[n]=t[n])}),e;e._from=[],void 0===t&&(t=[0,0,0,0]);var i=t instanceof Array?t:arguments;for(n=0,e.length=0;n<i.length;n++)((r=i[n])!=parseInt(r)||r<0||r>255)&&t0(i[n]),e.push(r);if(e.length!=[4,4,4,8,8,16,4,4,8,8,8,12,12,16,16,16][e[0]>>4])throw RangeError("Wrong UMP size");return e}function ni(){}tm.prototype.getChannel=function(){if(32==this.ff&&1==this.dd.length&&16>this.dd.charCodeAt(0))return this.dd.charCodeAt(0);var t=this[0];if(void 0!==t&&!(t<128)&&!(t>239))return 15&t},tm.prototype.setChannel=function(t){if(void 0===(t=tj[t]))return this;if(32==this.ff)this.dd=String.fromCharCode(t);else{var n=this[0];void 0!==n&&n>=128&&n<=239&&(this[0]=240&n|t)}return this},tm.prototype.getNote=function(){var t=this[0];if(void 0!==t&&!(t<128)&&!(t>175))return this[1]},tm.prototype.setNote=function(t){var n=this[0];return void 0===n||n<128||n>175||void 0!==(t=tm.noteValue(t))&&(this[1]=t),this},tm.prototype.getVelocity=function(){var t=this[0];if(void 0!==t&&!(t<128)&&!(t>159))return this[2]},tm.prototype.setVelocity=function(t){var n=this[0];return void 0===n||n<128||n>159||(t=parseInt(t))>=0&&t<128&&(this[2]=t),this},tm.prototype.getSysExId=function(){if(240==this[0])return this[2]},tm.prototype.setSysExId=function(t){return 240==this[0]&&this.length>2&&(t=parseInt(t))>=0&&t<128&&(this[2]=t),this},tm.prototype.getData=function(){if(void 0!==this.dd)return this.dd.toString()},tm.prototype.setData=function(t){return this.dd=tW(t),this},tm.prototype.getText=function(){if(void 0!==this.dd){var t,n,e,i;return(t=this.ff,n=this.dd,e=t,i=n,127==e&&void 0!==i&&67==i.charCodeAt(0)&&123==i.charCodeAt(1)&&1==n.charCodeAt(2))?function t(n,e){if(n>=0&&n<=127&&e>=0&&e<=127){var i=15&n,r=n>>4;return i>0&&i<8&&r<7?(i=["C","D","E","F","G","A","B"][i-1]+["bbb","bb","b","","#","##","###"][r],e>34)?i+"?":i+["","6","Maj7","Maj7(#11)","(9)","Maj7(9)","6(9)","aug","m","m6","m7","m7b5","m(9)","m7(9)","m7(11)","m+7","m+7(9)","dim","dim7","7","7sus4","7b5","7(9)","7(#11)","7(13)","7(b9)","7(b13)","7(#9)","Maj7aug","7aug","1+8","1+5","sus4","1+2+5","cc"][e]:"-"}return"-"}(this.dd.charCodeAt(3),this.dd.charCodeAt(4)):tl.lib.fromUTF8(this.dd)}if(this.isMidiSoft()){for(var r=[],o=6;o<this.length-1;o++)r.push(String.fromCharCode(this[o]));return r.join("")}},tm.prototype.setText=function(t){return this.dd=tl.lib.toUTF8(t),this},tm.prototype.getTempo=function(){if(81==this.ff&&void 0!==this.dd)return 65536*this.dd.charCodeAt(0)+256*this.dd.charCodeAt(1)+this.dd.charCodeAt(2)},tm.prototype.getBPM=function(){var t=this.getTempo();if(t)return 6e7/t},tm.prototype.getTimeSignature=function(){if(88==this.ff&&void 0!==this.dd)return[this.dd.charCodeAt(0),1<<this.dd.charCodeAt(1)]},tm.prototype.getTimeSignature4=function(){if(88==this.ff&&void 0!==this.dd){var t=[this.dd.charCodeAt(0),1<<this.dd.charCodeAt(1)];return 4==this.dd.length&&t.push(this.dd.charCodeAt(2),this.dd.charCodeAt(3)),t}},tm.prototype.getKeySignature=function(){if(89==this.ff&&void 0!==this.dd){var t=this.dd.charCodeAt(0),n=this.dd.charCodeAt(1);if(128&t&&(t-=256),t>=-7&&t<=7&&n>=0&&n<=1)return[t,["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#","G#","D#","A#"][n?t+10:t+7],!!n]}},tm.prototype.isNoteOn=function(){var t=this[0];return void 0!==t&&!(t<144)&&!(t>159)&&this[2]>0},tm.prototype.isNoteOff=function(){var t=this[0];return void 0!==t&&!(t<128)&&!(t>159)&&(t<144||0==this[2])},tm.prototype.isSysEx=function(){return 240==this[0]},tm.prototype.isFullSysEx=function(){return 240==this[0]&&247==this[this.length-1]},tm.prototype.isMidiSoft=function(){return this.isFullSysEx()&&0==this[1]&&32==this[2]&&36==this[3]&&0==this[4]},tm.prototype.isSMF=function(){return this.ff>=0&&this.ff<=127},tm.prototype.isEOT=function(){return 47==this.ff},tm.prototype.isText=function(){return 1==this.ff},tm.prototype.isCopyright=function(){return 2==this.ff},tm.prototype.isSeqName=function(){return 3==this.ff},tm.prototype.isInstrName=function(){return 4==this.ff},tm.prototype.isLyric=function(){return 5==this.ff},tm.prototype.isMarker=function(){return 6==this.ff},tm.prototype.isCuePoint=function(){return 7==this.ff},tm.prototype.isProgName=function(){return 8==this.ff},tm.prototype.isDevName=function(){return 9==this.ff},tm.prototype.isTempo=function(){return 81==this.ff},tm.prototype.isTimeSignature=function(){return 88==this.ff},tm.prototype.isKeySignature=function(){return 89==this.ff},tm.prototype.isGmReset=function(){return this.match([240,126,[0,0],9,[0,0],247])},tm.prototype.isGsReset=function(){return this.match([240,65,[0,0],66,18,64,0,127,0,65,247])},tm.prototype.isXgReset=function(){return this.match([240,67,[16,240],76,0,0,126,0,247])},tm.prototype.match=function(t){var n,e;for(n=0;n<t.length;n++)if(void 0===(e=t[n][1])){if(this[n]!=t[n])return!1}else if((this[n]&e)!=(t[n][0]&e))return!1;return!0},tm.prototype.label=function(t){return this.lbl=this.lbl?this.lbl+", "+t:t,this},tm.prototype.toString=function(){return this.lbl?this._str()+" ("+this.lbl+")":this._str()},tm.prototype._str=function(){var t,n;if(this.length)t=tJ(this);else{if(void 0===this.ff)return"empty";t="ff"+tZ(this.ff)}return(n=this._string())?t+" -- "+n:t},tm.prototype._string=function(){var t,n="";if(!this.length){if(0==this.ff)n+="Sequence Number: "+function t(n){for(var e=0,i=0;i<n.length;i++)e=(e<<8)+n.charCodeAt(i);return e}(this.dd);else if(this.ff>0&&this.ff<10)n+=["","Text","Copyright","Sequence Name","Instrument Name","Lyric","Marker","Cue Point","Program Name","Device Name"][this.ff]+tK(this.dd);else if(32==this.ff)n+="Channel Prefix"+tQ(this.dd);else if(33==this.ff)n+="MIDI Port"+tQ(this.dd);else if(47==this.ff)n+="End of Track"+tQ(this.dd);else if(81==this.ff)n+="Tempo: "+Math.round(100*this.getBPM())/100+" bpm";else if(84==this.ff)n+="SMPTE Offset: "+tx(tU(this.dd));else if(88==this.ff){var e=1<<this.dd.charCodeAt(1);n+="Time Signature: "+this.dd.charCodeAt(0)+"/"+e,n+=" "+this.dd.charCodeAt(2)+" "+this.dd.charCodeAt(3)}else if(89==this.ff){n+="Key Signature: ";var i=this.getKeySignature();i?(n+=i[1],i[2]&&(n+=" min")):n+="invalid"}else if(127==this.ff){if(67==this.dd.charCodeAt(0)&&123==this.dd.charCodeAt(1))return(n+="[XF:"+tZ(this.dd.charCodeAt(2))+"]",n+=(t=({0:"Version",1:"Chord",2:"Rehearsal Mark",3:"Phrase Mark",4:"Max Phrase Mark",5:"Fingering Number",12:"Guide Track Flag",16:"Guitar Info",18:"Chord Voicing",127:"XG Song Data Number"})[this.dd.charCodeAt(2)])?" "+t:"",n+=": ",0==this.dd.charCodeAt(2))?n+this.dd.substr(3,4)+" "+tJ(tU(this.dd.substr(7))):1==this.dd.charCodeAt(2)?n+this.getText():n+tJ(tU(this.dd.substr(3)));n+="Sequencer Specific"+tQ(this.dd)}else n+="SMF"+tQ(this.dd);return n}if(t=({241:"MIDI Time Code",242:"Song Position",243:"Song Select",244:"Undefined",245:"Undefined",246:"Tune request",248:"Timing clock",249:"Undefined",250:"Start",251:"Continue",252:"Stop",253:"Undefined",254:"Active Sensing",255:"Reset"})[this[0]])return t;if(this.isMidiSoft())return(t=tH(this.getText()))&&(t=" "+t),"[K:"+tZ(this[5])+"]"+t;var r=this[0]>>4;return(t=({8:"Note Off",10:"Aftertouch",12:"Program Change",13:"Channel Aftertouch",14:"Pitch Wheel"})[r])?t:9==r?this[2]?"Note On":"Note Off":11!=r?n:(t=({0:"Bank Select MSB",1:"Modulation Wheel MSB",2:"Breath Controller MSB",4:"Foot Controller MSB",5:"Portamento Time MSB",6:"Data Entry MSB",7:"Channel Volume MSB",8:"Balance MSB",10:"Pan MSB",11:"Expression Controller MSB",12:"Effect Control 1 MSB",13:"Effect Control 2 MSB",16:"General Purpose Controller 1 MSB",17:"General Purpose Controller 2 MSB",18:"General Purpose Controller 3 MSB",19:"General Purpose Controller 4 MSB",31:"Karaoke",32:"Bank Select LSB",33:"Modulation Wheel LSB",34:"Breath Controller LSB",36:"Foot Controller LSB",37:"Portamento Time LSB",38:"Data Entry LSB",39:"Channel Volume LSB",40:"Balance LSB",42:"Pan LSB",43:"Expression Controller LSB",44:"Effect control 1 LSB",45:"Effect control 2 LSB",48:"General Purpose Controller 1 LSB",49:"General Purpose Controller 2 LSB",50:"General Purpose Controller 3 LSB",51:"General Purpose Controller 4 LSB",64:"Damper Pedal",65:"Portamento",66:"Sostenuto",67:"Soft Pedal",68:"Legato",69:"Hold 2",70:"Sound Variation",71:"Filter Resonance",72:"Release Time",73:"Attack Time",74:"Brightness",75:"Decay Time",76:"Vibrato Rate",77:"Vibrato Depth",78:"Vibrato Delay",79:"Sound Controller 10",80:"General Purpose Controller 5",81:"General Purpose Controller 6",82:"General Purpose Controller 7",83:"General Purpose Controller 8",84:"Portamento Control",88:"High Resolution Velocity Prefix",91:"Effects 1 Depth",92:"Effects 2 Depth",93:"Effects 3 Depth",94:"Effects 4 Depth",95:"Effects 5 Depth",96:"Data Increment",97:"Data Decrement",98:"Non-Registered Parameter Number LSB",99:"Non-Registered Parameter Number MSB",100:"Registered Parameter Number LSB",101:"Registered Parameter Number MSB",120:"All Sound Off",121:"Reset All Controllers",122:"Local Control On/Off",123:"All Notes Off",124:"Omni Mode Off",125:"Omni Mode On",126:"Mono Mode On",127:"Poly Mode On"})[this[1]],this[1]>=64&&this[1]<=69&&(t+=this[2]<64?" Off":" On"),t||(t="Undefined"),t)},tm.prototype._stamp=function(t){return this._from.push(t._orig?t._orig:t),this},tm.prototype._unstamp=function(t){if(void 0===t)this._from=[];else{t._orig&&(t=t._orig);var n=this._from.indexOf(t);n>-1&&this._from.splice(n,1)}return this},tm.prototype._stamped=function(t){t._orig&&(t=t._orig);for(var n=0;n<this._from.length;n++)if(this._from[n]==t)return!0;return!1},tl.MIDI=tm,F.prototype.MIDI=tm,tl.Context=nt,F.prototype.Context=nt,nn.validate=function(t){var n=t instanceof Array?t:arguments;if(n[0]!=parseInt(n[0])||n[0]<0||n[0]>14)throw RangeError("Bad master channel value: "+n[0]);if(n[1]!=parseInt(n[1])||n[1]<0||n[0]+n[1]>15)throw RangeError("Bad zone size value: "+n[1])},nn.prototype.reset=function(){for(var t=0;t<16;t++)this[t]={band:0,master:t}},nn.prototype.setup=function(t,n){nn.validate(t,n);var e,i=t+n;if((this[t].master!=t||this[t].band!=n)&&(n||this[t].band)){for(this[t].band?i<(e=t+this[t].band)&&(i=e):this[t].master==t-1?(e=t-1,i<(e+=this[e].band)&&(i=e),this[t-1]={band:0,master:t-1}):this[t].master!=t&&(e=this[t].master,i<(e+=this[e].band)&&(i=e),this[this[t].master].band=t-this[t].master-1),this[t].master=t,this[t].band=n,e=t+1;e<=t+n;e++)this[e].band&&i<e+this[e].band&&(i=e+this[e].band),this[e]={band:0,master:t};for(;e<=i;e++)this[e]={band:0,master:e}}},nn.prototype.filter=function(t){var n,e,i,r=t.getChannel();if(!this[r]||!this[this[r].master].band)return t;var o=this[r].master,s=this[o].band;if(void 0!==t._mpe){for(i=256,n=o+1;n<=o+s;n++)if(this[n].notes){for(i>this[n].notes.length&&(r=n,i=this[n].notes.length),e=0;e<this[n].notes.length;e++)if(this[n].notes[e]==t._mpe){r=n,i=-1;break}}else i>0&&(r=n,i=0);t.setChannel(r),t._mpe=void 0}return r==o||(t.isNoteOn()?(this[r].notes||(this[r].notes=[]),T(this[r].notes,t.getNote())):t.isNoteOff()&&this[r].notes&&w(this[r].notes,t.getNote())),t},tl.MPE=nn,ne.prototype=[],ne.prototype.constructor=ne,ni.prototype=ne,ne._sxid=127,ne.sxId=function(t){if(void 0===t&&(t=ne._sxid),t==this._sxid)return this;t=tS(t);var n=new ni;return n._ch=this._ch,n._gr=this._gr,n._sxid=t,n},ne.ch=function(t){if(t==this._ch||void 0===t&&void 0===this._ch)return this;var n=new ni;return void 0!==t&&(t=tC(t)),n._ch=t,n._gr=this._gr,n._sxid=this._sxid,n},ne.gr=function(t){if(t==this._gr||void 0===t&&void 0===this._gr)return this;var n=new ni;return void 0!==t&&(t=tC(t)),n._ch=this._ch,n._gr=t,n._sxid=this._sxid,n},ne.prototype.getGroup=function(){if(this[0]){var t=this[0]>>4;if(1==t||2==t||3==t||4==t||5==t||13==t)return 15&this[0]}};var nr={noop:function(){return[0,0,0,0]},umpClock:function(t){return[0,16,(t=tT(t))>>8,255&t]},umpTimestamp:function(t){return[0,32,(t=tT(t))>>8,255&t]},umpTicksPQN:function(t){return[0,48,(t=tT(t))>>8,255&t]},umpDelta:function(t){return[0,64+((t=function t(n){if(n!=parseInt(n)||n<0||n>1048575)throw RangeError("Expected a 20-bit value: "+n);return parseInt(n)}(t=t||0))>>16),t>>8&255,255&t]},umpStartClip:function(){return[240,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},umpEndClip:function(){return[240,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},no={umpTempo:function(t,n){return[208+t,16,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,0,0,0,0,0]},umpBPM:function(t,n){return no.umpTempo(t,Math.round(6e9/n))},umpTimeSignature:function(t,n,e){var i,r,o,s=(""+n).match(/^\s*(\d+)\s*\/\s*(\d+)\s*$/);if(s?(i=parseInt(s[1]),r=parseInt(s[2])):n==parseInt(n)&&e==parseInt(e)&&(i=parseInt(n),r=parseInt(e)),i>0&&i<256&&r>0&&!(r&r-1)){for(o=0,r>>=1;r;r>>=1)o++;if((r=Math.round(32*i/(1<<o)))<256)return[208+t,16,0,1,i,o,r,0,0,0,0,0,0,0,0,0]}throw RangeError("Wrong time signature "+n+(void 0===e?"":"/"+e))}},ns={};function nu(t,n){return 1==t?0:0==n?16:n==t-1?48:32}function na(t,n){ne[t]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),void 0!==this._ch&&(t=[t[0]].concat([this._ch]).concat(t.slice(1))),new ne([32+t[0]].concat(n.apply(this,t.slice(1)),[0]).slice(0,4))}}A(nr,function(t){var n,e;n=t,e=nr[t],ne[n]=function(){return new ne(e.apply(this,arguments))}}),A(ns,function(t){var n,e;n=t,e=ns[t],ne[n]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),void 0!==this._ch&&(t=[t[0]].concat([this._ch]).concat(t.slice(1))),new ne(e.apply(this,t))}}),A(tI,function(t){na(t,tI[t])}),A(t3,function(t){na(t,t3[t])}),A(t7,function(t){var n,e;n=t,e=t7[t],ne[n]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),new ne([16+t[0]].concat(e.apply(this,t.slice(1)),[0,0]).slice(0,4))}}),A(no,function(t){var n,e;n=t,e=no[t],ne[n]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),new ne(e.apply(this,t))}}),A(tD,function(t){var n,e;n=t,e=tD[t],ne[n]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),function t(n,e){for(var i=[],r=e.slice(1,e.length-1);r.length;r=r.slice(6))i.push(r.slice(0,6));for(var o=0;o<i.length;o++)i[o]=new ne([48+n,nu(i.length,o)+i[o].length].concat(i[o],[0,0,0,0,0]).slice(0,8));return i}(t[0],e.apply(this,t.slice(1)))}}),ne.prototype.getTempo=function(){if(this.isTempo())return(this[4]<<24)+(this[5]<<16)+(this[6]<<8)+this[7]},ne.prototype.getBPM=function(){var t=this.getTempo();if(t)return Math.round(6e9/t)},ne.prototype.getTimeSignature=function(){if(this.isTimeSignature())return[this[4],1<<this[5]]},ne.prototype.getDelta=function(){if(this.isDelta())return((15&this[1])<<16)+(this[2]<<8)+this[3]},ne.prototype.isTempo=function(){return this[0]>>4==13&&this[1]>>4==1&&0==this[2]&&0==this[3]},ne.prototype.isTimeSignature=function(){return this[0]>>4==13&&this[1]>>4==1&&0==this[2]&&1==this[3]},ne.prototype.isDelta=function(){return 0==this[0]&&this[1]>>4==4},ne.prototype.isStartClip=function(){return this.match([240,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0])},ne.prototype.isEndClip=function(){return this.match([240,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0])},ne.prototype.toString=tm.prototype.toString,ne.prototype._str=function(){var t=this._string();return t?tX(this)+" -- "+t:tX(this)},ne.prototype._string=function(){var t,n,e=this[0]>>4;if(1==e||2==e)return new tm(this.slice(1))._string();if(0==e)return["NOOP","JR Clock","JR Timestamp","Ticks Per Quarter Note","Delta Ticks"][t=this[1]>>4];if(208==this[0]&&0==this[2]){if(0==this[3])return"Tempo "+this.getBPM()+" BPM";if(1==this[3])return"Time Signature "+this.getTimeSignature().join("/")}if(240==this[0])return({32:"Start of Clip",33:"End of Clip"})[this[1]]},ne.prototype._stamp=tm.prototype._stamp,ne.prototype._unstamp=tm.prototype._unstamp,ne.prototype._stamped=tm.prototype._stamped,ne.prototype.match=tm.prototype.match,tl.UMP=ne,F.prototype.UMP=ne,tl.lib={},tl.lib.now=p,tl.lib.schedule=d;var nf=[],nh=0;try{var nc=URL.createObjectURL(new Blob(["(",(function(){!function t(){postMessage({}),setTimeout(t,0)}()}).toString(),")()"],{type:"application/javascript"})),n$=function(){for(var t=nf.length,n=0;n<t;n++)nf.shift()();++nh>20&&a&&(a.terminate(),a=void 0)},nl=function(t){nf.push(t),nh=0,a||((a=new Worker(nc)).onmessage=n$)};nl(function(){tl.lib.schedule=nl})}catch(np){}tl.lib.openMidiOut=function(t,n){var e=new U;return n._openOut(e),e._info=n._info(t),e},tl.lib.openMidiIn=function(t,n){var e=new U;return n._openIn(e),e._info=n._info(t),e},tl.lib.registerMidiOut=function(t,n){for(var e=n._info(t),i=0;i<te._outs.length;i++)if(te._outs[i].name==e.name)return!1;return e.engine=n,te._outs.push(e),o&&(N(),o._bad&&(o._repair(),o._resume())),!0},tl.lib.registerMidiIn=function(t,n){for(var e=n._info(t),i=0;i<te._ins.length;i++)if(te._ins[i].name==e.name)return!1;return e.engine=n,te._ins.push(e),o&&(N(),o._bad&&(o._repair(),o._resume())),!0},tl.lib.copyMidiHelpers=tV,tl.lib.getAudioContext=function(){return function t(){if(!f&&"undefined"!=typeof window){var n=window.AudioContext||window.webkitAudioContext;if(n){(f=new n).createGain||(f.createGain=f.createGainNode);var e=function(){if("running"!=f.state){f.resume();var t=f.createOscillator(),n=f.createGain();try{n.gain.value=0}catch(i){}n.gain.setTargetAtTime(0,f.currentTime,.01),t.connect(n),n.connect(f.destination),t.start||(t.start=t.noteOn),t.stop||(t.stop=t.noteOff),t.start(.1),t.stop(.11)}else"undefined"!=typeof document&&(document.removeEventListener("touchstart",e),document.removeEventListener("touchend",e),document.removeEventListener("mousedown",e),document.removeEventListener("keydown",e))};"undefined"!=typeof document&&(document.addEventListener("touchstart",e),document.addEventListener("touchend",e),document.addEventListener("mousedown",e),document.addEventListener("keydown",e)),e()}}}(),f};var nd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";tl.lib.fromBase64=function(t){var n,e,i,r,o,s,u,a="",f=0;for(t=t.replace(/[^A-Za-z0-9+/=]/g,"");f<t.length;)r=nd.indexOf(t.charAt(f++)),o=nd.indexOf(t.charAt(f++)),s=nd.indexOf(t.charAt(f++)),u=nd.indexOf(t.charAt(f++)),n=r<<2|o>>4,e=(15&o)<<4|s>>2,i=(3&s)<<6|u,a+=String.fromCharCode(n),64!=s&&(a+=String.fromCharCode(e)),64!=u&&(a+=String.fromCharCode(i));return a},tl.lib.toBase64=function(t){var n,e,i,r,o,s,u,a,f=0,h=0,c="",$=[];if(!t)return t;do n=t.charCodeAt(f++),r=(a=n<<16|(e=t.charCodeAt(f++))<<8|(i=t.charCodeAt(f++)))>>18&63,o=a>>12&63,s=a>>6&63,u=63&a,$[h++]=nd.charAt(r)+nd.charAt(o)+nd.charAt(s)+nd.charAt(u);while(f<t.length);c=$.join("");var l=t.length%3;return l?c.slice(0,l-3)+"===".slice(l):c},tl.lib.fromUTF8=function(t){t=void 0===t?"":""+t;var n,e,i,r="";for(n=0;n<t.length;n++){if((e=t.charCodeAt(n))>255)return t;if(e<128)r+=t[n];else if((224&e)==192){if(e=(31&e)<<6,++n>=t.length||(192&(i=t.charCodeAt(n)))!=128)return t;e+=63&i,r+=String.fromCharCode(e)}else if((240&e)==224){if(e=(15&e)<<12,++n>=t.length||(192&(i=t.charCodeAt(n)))!=128||(e+=(63&i)<<6,++n>=t.length||(192&(i=t.charCodeAt(n)))!=128))return t;e+=63&i,r+=String.fromCharCode(e)}else if((248&e)==240){if(e=(7&e)<<18,++n>=t.length||(192&(i=t.charCodeAt(n)))!=128||(e+=(63&i)<<12,++n>=t.length||(192&(i=t.charCodeAt(n)))!=128)||(e+=(63&i)<<6,++n>=t.length||(192&(i=t.charCodeAt(n)))!=128||(e+=63&i)>1114111))return t;e-=65536,r+=String.fromCharCode(55296+(e>>10)),r+=String.fromCharCode(56320+(1023&e))}}return r},tl.lib.toUTF8=function(t){t=void 0===t?"":""+t;var n,e,i="";for(n=0;n<t.length;n++)(e=t.charCodeAt(n))<128?i+=t[n]:e<2048?(i+=String.fromCharCode(192+(e>>6)),i+=String.fromCharCode(128+(63&e))):e<65536?(i+=String.fromCharCode(224+(e>>12)),i+=String.fromCharCode(128+(e>>6&63)),i+=String.fromCharCode(128+(63&e))):(i+=String.fromCharCode(240+(e>>18)),i+=String.fromCharCode(128+(e>>12&63)),i+=String.fromCharCode(128+(e>>6&63)),i+=String.fromCharCode(128+(63&e)));return i};var n8=[],ng={},nx={},nm=h.Promise;function nv(t,n,e){this.name=t,this.message=n,this.code=e}function n_(t,n){this.bubbles=!1,this.cancelBubble=!1,this.cancelable=!1,this.currentTarget=n,this.defaultPrevented=!1,this.eventPhase=0,this.path=[],this.port=t,this.returnValue=!0,this.srcElement=n,this.target=n,this.timeStamp=p(),this.type="statechange"}function ny(t,n){this.bubbles=!1,this.cancelBubble=!1,this.cancelable=!1,this.currentTarget=t,this.data=n,this.defaultPrevented=!1,this.eventPhase=0,this.path=[],this.receivedTime=p(),this.returnValue=!0,this.srcElement=t,this.target=t,this.timeStamp=this.receivedTime,this.type="midimessage"}function nb(t,n){t&&(t.onstatechange&&t.onstatechange(new n_(t,t)),n.onstatechange&&n.onstatechange(new n_(t,n)))}function n0(t,n){var e=this,i=!1,r=null,o=null;this.type="input",this.id=n.id,this.name=n.name,this.manufacturer=n.man,this.version=n.ver,Object.defineProperty(this,"state",{get:function(){return n.connected?"connected":"disconnected"},enumerable:!0}),Object.defineProperty(this,"connection",{get:function(){return i?n.proxy?"open":"pending":"closed"},enumerable:!0}),Object.defineProperty(this,"onmidimessage",{get:function(){return o},set:function(t){x(t)?(o=t,i||e.open().then(g,g)):o=null},enumerable:!0}),Object.defineProperty(this,"onstatechange",{get:function(){return r},set:function(t){r=x(t)?t:null},enumerable:!0}),this.open=function(){return new nm(function(r,o){i?r(e):n.open().then(function(){i||(i=!0,nb(e,t)),r(e)},function(){o(new nv("InvalidAccessError","Port is not available",15))})})},this.close=function(){return new nm(function(r){i&&(i=!1,n.close(),nb(e,t)),r(e)})},Object.freeze(this)}function nM(t){for(var n,e;t.length;){for(n=0;n<t.length&&(t[n]!=parseInt(t[n])||!(t[n]>=128)||!(t[n]<=255)||247==t[n]);n++);if(t.splice(0,n),!t.length)return;if(240==t[0]){for(n=1;n<t.length&&247!=t[n];n++);if(n==t.length)return;return t.splice(0,n+1)}if((e=nS(t[0])+1)>t.length)return;for(n=1;n<e&&t[n]==parseInt(t[n])&&!(t[n]<0)&&!(t[n]>=128);n++);if(n==e)return t.splice(0,n);t.splice(0,n)}}function nC(n,e,i,r){var o=this;this.id=n,this.name=e,this.man=i,this.ver=r,this.connected=!0,this.ports=[],this.pending=[],this.proxy=void 0,this.queue=[],this.onmidi=function(n){var e;for(o.queue=o.queue.concat(n.slice()),e=nM(o.queue);e;e=nM(o.queue))for(t=0;t<o.ports.length;t++)o.ports[t][0].onmidimessage&&(240!=e[0]||o.ports[t][1])&&o.ports[t][0].onmidimessage(new ny(o,new Uint8Array(e)))}}function nS(t){return t>=128&&t<=191||t>=224&&t<=239||242==t?2:t>=192&&t<=223||241==t||243==t?1:0}"function"!=typeof nm&&((nm=function(t){this.executor=t}).prototype.then=function(t,n){"function"!=typeof t&&(t=g),"function"!=typeof n&&(n=g),this.executor(t,n)}),nC.prototype.open=function(){var t=this;return new nm(function(n,e){var i;t.proxy||!t.connected?n():(t.pending.push([n,e]),1==t.pending.length&&tl().openMidiIn(t.name).or(function(){for(i=0;i<t.pending.length;i++)t.pending[i][1]();t.pending=[]}).and(function(){for(t.proxy=this,t.proxy.connect(t.onmidi),i=0;i<t.pending.length;i++)t.pending[i][0]();t.pending=[]}))})},nC.prototype.close=function(){var t;if(this.proxy){for(t=0;t<this.ports.length;t++)if("open"==this.ports[t].connection)return;this.proxy.close(),this.proxy=void 0}},nC.prototype.disconnect=function(){this.connected=!1,this.proxy&&(this.proxy.close(),this.proxy=void 0)},nC.prototype.reconnect=function(){var t,n,e=this,i=[];for(t=0,this.connected=!0;t<n8.length;t++)"closed"==(n=n8[t].inputs.get(this.id)).connection?nb(n,n8[t]):i.push([n,n8[t]]);i.length&&tl()._openMidiInNR(e.name).or(function(){for(t=0;t<i.length;t++)i[t][0].close()}).and(function(){for(e.proxy=this,e.proxy.connect(e.onmidi),t=0;t<i.length;t++)nb(i[t][0],i[t][1])})};var n2="Failed to execute 'send' on 'MIDIOutput': ";function nB(t,n){var e=this,i=!1,r=null;this.type="output",this.id=n.id,this.name=n.name,this.manufacturer=n.man,this.version=n.ver,Object.defineProperty(this,"state",{get:function(){return n.connected?"connected":"disconnected"},enumerable:!0}),Object.defineProperty(this,"connection",{get:function(){return i?n.proxy?"open":"pending":"closed"},enumerable:!0}),Object.defineProperty(this,"onstatechange",{get:function(){return r},set:function(t){r=x(t)?t:null},enumerable:!0}),this.open=function(){return new nm(function(r,o){i?r(e):n.open().then(function(){i||(i=!0,nb(e,t)),r(e)},function(){o(new nv("InvalidAccessError","Port is not available",15))})})},this.close=function(){return new nm(function(r){i&&(i=!1,e.clear(),n.close(),nb(e,t)),r(e)})},this.clear=function(){},this.send=function(r,o){if(function t(n,e){var i,r,o,s=[];for(i=0;i<n.length;i++)if(n[i]!=parseInt(n[i])||n[i]<0||n[i]>255)throw TypeError(n2+n[i]+" is not a UInt8 value.");for(i=0,r=0;i<n.length;i++)if(r){if(n[i]>127)throw TypeError(n2+"Unexpected status byte at index "+i+" ("+n[i]+").");o.push(n[i]),r--}else{if(n[i]<128)throw TypeError(n2+"Running status is not allowed at index "+i+" ("+n[i]+").");if(247==n[i])throw TypeError(n2+"Unexpected end of system exclusive message at index "+i+" ("+n[i]+").");if(o=[n[i]],s.push(o),240==n[i]){if(!e)throw new nv("InvalidAccessError",n2+"System exclusive messag is not allowed at index "+i+" ("+n[i]+").",15);for(r=-1;i<n.length;i++)if(o.push(n[i]),247==n[i]){r=0;break}}else r=nS(n[i])}if(r)throw TypeError(n2+"Message is incomplete");return[s]}(r,t.sysexEnabled),!n.connected)throw new nv("InvalidStateError","Port is not connected",11);if(i){var s=p();o>s?setTimeout(function(){n.proxy.send(r)},o-s):n.proxy.send(r)}else this.open().then(function(){e.send(r,o)},g)},Object.freeze(this)}function nT(t,n,e,i){this.id=t,this.name=n,this.man=e,this.ver=i,this.connected=!0,this.ports=[],this.pending=[],this.proxy=void 0}function nw(t){this.has=function(n){return t.hasOwnProperty(n)&&t[n].connected},this.keys=function(){try{var n=new Map;for(var e in t)this.has(e)&&n.set(e,this.get(e));return n.keys()}catch(i){}},this.values=function(){try{var n=new Map;for(var e in t)this.has(e)&&n.set(e,this.get(e));return n.values()}catch(i){}},this.entries=function(){try{var n=new Map;for(var e in t)this.has(e)&&n.set(e,this.get(e));return n.entries()}catch(i){}},this.forEach=function(n,e){for(var i in void 0===e&&(e=this),t)this.has(i)&&n.call(e,this.get(i),i,this)},Object.defineProperty(this,"size",{get:function(){var n=0;for(var e in t)this.has(e)&&n++;return n},enumerable:!0})}function n5(t,n){this.get=function(e){if(nx.hasOwnProperty(e)&&nx[e].connected)return n[e]||(n[e]=new n0(t,nx[e]),nx[e].ports.push([n[e],t.sysexEnabled])),n[e]},Object.freeze(this)}function nF(t,n){this.get=function(e){if(ng.hasOwnProperty(e)&&ng[e].connected)return n[e]||(n[e]=new nB(t,ng[e]),ng[e].ports.push([n[e],t.sysexEnabled])),n[e]},Object.freeze(this)}function n6(t){var n,e,i,r;for(n=0;n<t.inputs.added.length;n++)i=t.inputs.added[n],nx.hasOwnProperty(i.id)||(nx[i.id]=new nC(i.id,i.name,i.manufacturer,i.version)),nx[i.id].reconnect();for(n=0;n<t.outputs.added.length;n++)i=t.outputs.added[n],ng.hasOwnProperty(i.id)||(ng[i.id]=new nT(i.id,i.name,i.manufacturer,i.version)),ng[i.id].reconnect();for(n=0;n<t.inputs.removed.length;n++)if(i=t.inputs.removed[n],nx.hasOwnProperty(i.id)){for(e=0,r=[];e<n8.length;e++)r.push([n8[e].inputs.get(i.id),n8[e]]);for(nx[i.id].disconnect(),e=0;e<r.length;e++)nb(r[e][0],r[e][1])}for(n=0;n<t.outputs.removed.length;n++)if(i=t.outputs.removed[n],ng.hasOwnProperty(i.id)){for(e=0,r=[];e<n8.length;e++)r.push([n8[e].outputs.get(i.id),n8[e]]);for(ng[i.id].disconnect(),e=0;e<r.length;e++)nb(r[e][0],r[e][1])}}function n1(t){var n,e,i=null;this.sysexEnabled=t,this.inputs=new n5(this,{}),this.outputs=new nF(this,{}),Object.defineProperty(this,"onstatechange",{get:function(){return i},set:function(t){i=x(t)?t:null},enumerable:!0}),Object.freeze(this);var r=o._info;for(n=0;n<r.inputs.length;n++)e=r.inputs[n],nx.hasOwnProperty(e.id)||(nx[e.id]=new nC(e.id,e.name,e.manufacturer,e.version));for(n=0;n<r.outputs.length;n++)e=r.outputs[n],ng.hasOwnProperty(e.id)||(ng[e.id]=new nT(e.id,e.name,e.manufacturer,e.version));n8.length||tl().onChange(n6),n8.push(this)}return nT.prototype.open=function(){var t=this;return new nm(function(n,e){var i;t.proxy||!t.connected?n():(t.pending.push([n,e]),1==t.pending.length&&tl().openMidiOut(t.name).or(function(){for(i=0;i<t.pending.length;i++)t.pending[i][1]();t.pending=[]}).and(function(){for(i=0,t.proxy=this;i<t.pending.length;i++)t.pending[i][0]();t.pending=[]}))})},nT.prototype.close=function(){var t;if(this.proxy){for(t=0;t<this.ports.length;t++)if("open"==this.ports[t].connection)return;this.proxy.close(),this.proxy=void 0}},nT.prototype.disconnect=function(){this.connected=!1,this.proxy&&(this.proxy.close(),this.proxy=void 0)},nT.prototype.reconnect=function(){var t,n,e=this,i=[];for(t=0,this.connected=!0;t<n8.length;t++)"closed"==(n=n8[t].outputs.get(this.id)).connection?nb(n,n8[t]):i.push([n,n8[t]]);i.length&&tl()._openMidiOutNR(e.name).or(function(){for(t=0;t<i.length;t++)i[t][0].close()}).and(function(){for(t=0,e.proxy=this;t<i.length;t++)nb(i[t][0],i[t][1])})},n5.prototype=new nw(nx),n5.prototype.constructor=n5,nF.prototype=new nw(ng),nF.prototype.constructor=nF,tl.requestMIDIAccess=function(t){return new nm(function(n,e){tl.JZZ(t).or(function(){}).and(function(){var i=!!(t&&t.sysex);if(i&&!this.info().sysex)e(new nv("SecurityError","Sysex is not allowed",18));else{var r=new n1(i);n(r)}})})},"undefined"==typeof navigator||navigator.requestMIDIAccess||(navigator.requestMIDIAccess=tl.requestMIDIAccess),tl.close=function(){tn._close&&tn._close()},tl});